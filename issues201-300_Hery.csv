number,title,state,created_at,updated_at,closed_at,body,labels,assignees,milestone,comments
11074,ExoPlaybackException occurs on some terminals,open,2023-03-17 10:12:18,2023-07-27 00:44:32,,"I added a comment to a previously CLOSED https://github.com/google/ExoPlayer/issues/10567, but did not receive a response, so I started a new issue.
This problem still occurs.
I have retrieved the `data` for the device where the error occurred, since there was a previous request for `ProvisioningRequest` `data`.
Please check it.

https://github.com/google/ExoPlayer/issues/10567#issuecomment-1465546828",['bug: in platform drm'],['rrfrias'],,7
11073,Failed to get key request,closed,2023-03-16 14:11:57,2023-06-20 01:05:39,2023-04-20 01:05:55,"Some of ours users are getting the error “Failed to get key request” when trying to download/stream Widevine content. This is an example of what we are seeing in user logs

    EXOPLAYER VERSION: 2.15.1 
    SDK:30 
    MODEL:ONEPLUS A6003
    com.google.android.exoplayer2.drm.DrmSession$DrmSessionException :: android.media.MediaDrm$MediaDrmStateException: Failed to get key request: General DRM error
	at com.google.android.exoplayer2.drm.DefaultDrmSession.t(DefaultDrmSession.java:2)
	at com.google.android.exoplayer2.drm.DefaultDrmSession.v(DefaultDrmSession.java:3)
	at com.google.android.exoplayer2.drm.DefaultDrmSession.C(DefaultDrmSession.java:4)
	at com.google.android.exoplayer2.drm.DefaultDrmSession.n(DefaultDrmSession.java:8)
	at com.google.android.exoplayer2.drm.DefaultDrmSession.a(DefaultDrmSession.java:9)
	at com.google.android.exoplayer2.drm.DefaultDrmSessionManager.v(DefaultDrmSessionManager.java:5)
	at com.google.android.exoplayer2.drm.DefaultDrmSessionManager.w(DefaultDrmSessionManager.java:1)
	at com.google.android.exoplayer2.drm.DefaultDrmSessionManager.s(DefaultDrmSessionManager.java:17)
	at com.google.android.exoplayer2.drm.DefaultDrmSessionManager.a(DefaultDrmSessionManager.java:3)
	at com.google.android.exoplayer2.drm.OfflineLicenseHelper.d(OfflineLicenseHelper.java:5)
	at com.google.android.exoplayer2.drm.OfflineLicenseHelper.b(OfflineLicenseHelper.java:2)
	at com.google.android.exoplayer2.drm.OfflineLicenseHelper.c(OfflineLicenseHelper.java:2)

Based on this ticket we found https://github.com/google/ExoPlayer/issues/8039,
we implemented a similar process to ‘force provision’ the device, but we are not sure if this will actually fix the issue and it invalidates the already downloaded Widevine content. We were hoping that a better solution is available. 

In our normal L1 flow, we check if the device is provisioned on startup and if it hasn’t we send the provisioning request. We do this to avoid the latency on the user’s first download or streaming attempt. We are considering removing this as a potential reason for error. Instead, we would rely on provision requests from Exoplayer at time of download/playback. We are not confident that this is the problem and it doesn’t fix the current user’s issues.

Is there any documentation around these errors? Are you aware of what could cause this failure and/or steps to resolve?
","['question', 'bug: in platform drm', 'closed-by-bot']",['rrfrias'],,3
11072,MiniPlayer in exoplayer,open,2023-03-16 14:11:51,2023-03-16 15:07:03,,How to Implement Mini Player View between switching fragments,['question'],['marcbaechinger'],,1
11071,Pass offlineLicenseKeySetId to App from DefaultDrmSession,closed,2023-03-16 13:09:55,2023-05-17 01:05:30,2023-03-17 11:14:12,"ExoPlayer version: 2.18.2
HW Platform: Generic Android TV

We have used MODE_DOWNLOAD to serve two purposes at the same time
- Play the encrypted OTT content
- Persist the license key to MediaDrm, so that for the next playback, we don't need to send another request to the DRM server. 

```
defaultDrmSessionManager.setMode(MODE_PLAYBACK, drmConfiguration.getKeySetId());
```

And according to the return from `MediaDrm.queryKeyStatus()`, this seems to be possible (PersistAllowed & PlayAllowed). Here are the logs

```
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = PersistAllowed, value = True
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = PlayAllowed, value = True
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = PlaybackDurationRemaining, value = 795009
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = LicenseDurationRemaining, value = 794781
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = RenewalServerUrl, value = 
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = RenewAllowed, value = False
2023-03-16 13:07:17.589 12743-993   DefaultDrmSession       XXX         E  license status: key = LicenseType, value = Offline
```

We have made a POC, and it seems work
- For the 1st run, we use MODE_DOWNLOAD and printout the `offlineLIcenseKeySetId` to logcat. The following is the sample code
```
  private void onKeyResponse(Object request, Object response) {// In DefaultDrmSession.java
      byte[] responseData = (byte[]) response;
//...     
      byte[] keySetId = mediaDrm.provideKeyResponse(sessionId, responseData);
      Log.e(TAG, ""offlineLicenseKeySetId = "" + Arrays.toString(keySetId));
```
- For the 2nd run, we copy & paste the offlineLicenseKeySetId from logcat and hardcode it
```
      byte[] offlineKeyId =  {107, 115, 105, 100, 70, 67, 70, 52, 57, 56, 51, 57}; // copied from the last run
      drmConfiguration = new MediaItem.DrmConfiguration.Builder(C.WIDEVINE_UUID)
              .setKeySetId(offlineKeyId)
```

The issue
-
We are have difficulty in passing `offlineLicenseKeySetId` in `DefaultDrmSession::onKeyResponse()` to the App layer elegantly. There are quite a few components in between, `DefaultDrmSessionManager`, `DefaultDrmSessionManagerProvider`... We'd really appreciate any suggestions.","['question', 'needs triage']",['icbaker'],,1
11070,Seeking for 4K HDR MP4 file is not working,closed,2023-03-16 09:28:20,2023-06-01 01:05:25,2023-03-20 08:59:58,"### ExoPlayer Version

2.18.4

### Devices that reproduce the issue

Any device.

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Open the video.

### Expected result

Seeking is working.

### Actual result

Try to seek the video, it won't work.

### Media

Video link has been sent to dev email.

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'bad media']",['christosts'],,2
11069,RTSP UDP->TCP failover inconsistency,closed,2023-03-16 03:32:26,2023-06-04 01:05:05,2023-04-04 10:10:49,"Hi, this is related to #9884

ExoPlayer has a feature with RTSP that if a UDP stream isn't received within a few seconds, it'll try again with TCP (Good feature)

If the server tells ExoPlayer that a UDP stream isn't available, and ""RTSP/1.0 461 Unsupported Transport"", it will NOT try TCP

Where this becomes a problem: If WMPlayer connects to a server with UDP available, and it doesn't receive a stream within a few seconds, it doesn't failover to TCP 

I can do a work-around to tell WMPlayer clients that UDP is unavailable as a transport based on the User-Agent, but this does leave ExoPlayer clients waiting a few more seconds for video to start.

* VRChat
* AVPro (video widget)
* Windows Media API or ExoPlayer depending on platform

Is there a reason to not understand the ""Unsupported Transport"" response? I notice that a LibVLC supports this. ",['question'],['microkatz'],,1
11068,video downloading is stop at the same point,closed,2023-03-16 02:50:38,2023-06-01 01:05:25,2023-03-20 05:04:22,"
![225493117-9f975692-dcd9-4a3f-a733-8d4a311bc42c](https://user-images.githubusercontent.com/89774934/225498100-fedc606d-7829-4805-9f86-57f03225415f.png)

please i need help
I have observed that when the network connection is lost, the local database metadata is set to 0000000, and when the network connection is restored, video download stops at the same point. It seems that the cache data has been corrupted, and the data source is attempting to read it.","['question', 'need more info']",['marcbaechinger'],,2
11067,HTTP URIs not supported,closed,2023-03-15 19:08:34,2023-05-15 01:05:27,2023-03-15 20:33:20,"Hello! 
Dont work playing audio from URL ""http://78.129.229.120:10741/""
How can fix it?",['question'],['marcbaechinger'],,1
11066,Getting exception: com.google.android.exoplayer2.ExoPlaybackException: MediaCodecAudioRenderer,closed,2023-03-15 15:34:53,2023-08-12 01:04:33,2023-06-12 01:05:52,"Hi according to our support team we are getting next exception: 


com.google.android.exoplayer2.ExoPlaybackException: MediaCodecAudioRenderer error, index=1, format=Format(null, null, null, audio/raw, null, -1, null, [-1, -1, -1.0], [2, 48000]), format_supported=YES at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(:43) at android.os.Handler.dispatchMessage(Handler.java:103) at android.os.Looper.loop(Looper.java:214) at android.os.HandlerThread.run(HandlerThread.java:67) Caused by: com.google.android.exoplayer2.audio.AudioSink$InitializationException: AudioTrack init failed 0 Config(48000, 12, 65600) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.buildAudioTrack(:7) at com.google.android.exoplayer2.audio.DefaultAudioSink.buildAudioTrack(:1) at com.google.android.exoplayer2.audio.DefaultAudioSink.buildAudioTrackWithRetry(:1) at com.google.android.exoplayer2.audio.DefaultAudioSink.initializeAudioTrack(:2) at com.google.android.exoplayer2.audio.DefaultAudioSink.handleBuffer(:16) at com.google.android.exoplayer2.audio.MediaCodecAudioRenderer.processOutputBuffer(:7) at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.drainOutputBuffer(:32) at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(:16) at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(:14) at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(:25) ... 3 more Suppressed: com.google.android.exoplayer2.audio.AudioSink$InitializationException: AudioTrack init failed 0 Config(48000, 12, 65600) ... 13 more Caused by: java.lang.UnsupportedOperationException: Cannot create AudioTrack at android.media.AudioTrack$Builder.build(AudioTrack.java:1018) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.createAudioTrackV29(:11) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.createAudioTrack(:2) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.buildAudioTrack(:1) ... 12 more Caused by: java.lang.UnsupportedOperationException: Cannot create AudioTrack at android.media.AudioTrack$Builder.build(AudioTrack.java:1018) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.createAudioTrackV29(:11) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.createAudioTrack(:2) at com.google.android.exoplayer2.audio.DefaultAudioSink$Configuration.buildAudioTrack(:1) ... 12 more

I have investigated this error and I found that main possible reasons: 

- **Memory leak in the application**, not releasing the player resources can cause the initialisation of the application to fail. That cause has been ruled out as it has been checked that the player instance is freed correctly.

- **We can see in the logs that audio decoder is released after getting an error first time**: 

audioDecoderReleased [eventTime=1.67, mediaPos=30.70, window=0, period=0, c2.android.aac.decoder]

After that we retry and we still get the same error. 

- **Unsupported audio format**: audio codec used is:  audio/mp4a-latm ,  according to the logs we can see the format is supported by the device.

**- Bad media?? audio chunks are corrupted.** 


Do you have any idea more what could be the root of the cause? Since it is not really clear wha could be the reason apart from bad media chunks being returned from the content source.

I have sent report a logs to exoplayer gmail account.  





 
","['question', 'bug: device specific', 'closed-by-bot']",['christosts'],,6
11065,"It works with the default MediaPlayer, but not with Exoplayer. (attached a demo file)",closed,2023-03-15 06:17:54,2023-05-15 01:05:28,2023-03-15 23:34:24,"### ExoPlayer Version

2.18.4

### Devices that reproduce the issue

target device : Quber QUBER QR1G_M110S (Android Pie. AOSP)

demo file url
[https://drive.google.com/file/d/1hj8_q1D6bAjco6IjQ2wSmOKBPci2_sCO/view?usp=share_link](https://drive.google.com/file/d/1hj8_q1D6bAjco6IjQ2wSmOKBPci2_sCO/view?usp=share_link)
(27s 70MB)



Hello, I am developing a player that plays local files using exoPlayer. Most files are played well, but only the attached file does not play. I have checked the file specification as follows.

The error that occurs is as follows. 
```
 vcodec counter : DecoderCounters {
  decoderInits=1,
  decoderReleases=0
  queuedInputBuffers=811
  skippedInputBuffers=0
  renderedOutputBuffers=0 // I think this line is the problem
  skippedOutputBuffers=0
  droppedBuffers=0
  droppedInputBuffers=0
  maxConsecutiveDroppedBuffers=0
  droppedToKeyframeEvents=0
  totalVideoFrameProcessingOffsetUs=0
  videoFrameProcessingOffsetCount=0
 }
```

The attempted solutions are as follows.
```
1.  val trackSelector = DefaultTrackSelector(this)
        val trackSelectionParameters = trackSelector.parameters
            .buildUpon()
            .setForceHighestSupportedBitrate(true)
            //    .setAllowNonSeamlessAdaptiveness(true) // important!
            .setAllowVideoNonSeamlessAdaptiveness(true)
            .setAllowVideoMixedDecoderSupportAdaptiveness(true)
            .build()
        trackSelector.parameters = trackSelectionParameters

 2. val loadControl = DefaultLoadControl.Builder()
            .setBufferDurationsMs(32 * 1024, 64 * 1024, 1024, 1024) // set buffer size!
            .build()
```
Thank you.

ps
I received help as fllows

https://github.com/google/ExoPlayer/issues/2979
https://github.com/google/ExoPlayer/issues/1894
https://github.com/google/ExoPlayer/issues/2657

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Demo file

[https://drive.google.com/file/d/1hj8_q1D6bAjco6IjQ2wSmOKBPci2_sCO/view?usp=share_link](https://drive.google.com/file/d/1hj8_q1D6bAjco6IjQ2wSmOKBPci2_sCO/view?usp=share_link)

### Expected result

Playing demo file

### Actual result

2023-03-15 14:41:53.887 E: this frame is Error frame!,pOutput.timeUs = 1000026342983
...(1000 or more)...



### Media

demo uri
[https://drive.google.com/file/d/1hj8_q1D6bAjco6IjQ2wSmOKBPci2_sCO/view?usp=share_link]https://drive.google.com/file/d/1hj8_q1D6bAjco6IjQ2wSmOKBPci2_sCO/view?usp=share_link

No license restrictions

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug: device specific'],['marcbaechinger'],,2
11064,Fix VP9 color space parsing in MP4 atom parser,closed,2023-03-15 00:13:57,2023-05-16 01:05:27,2023-03-16 16:57:23,"This adds VP9 color space parsing in MP4 vpcC atom.

Please refer to VP9 MP4 atom syntax documentation: https://www.webmproject.org/vp9/mp4/#syntax_1

This fix is needed to have correct color space parsing in vpcC atom because Instagram serves HDR VP9 encodings in MP4 containers.",['should merge'],['rohitjoins'],,2
11063,Fix VP9 color space parsing in MP4 atom parser,closed,2023-03-15 00:11:30,2023-05-14 01:04:59,2023-03-15 00:13:30,"This adds vpcC atom parsing based on the open-source FFmpeg implementation (https://github.com/FFmpeg/FFmpeg/blob/master/libavformat/vpcc.c#L213)

This fix is needed to have correct color space parsing in vpcC atom because Instagram serves HDR VP9 encodings in MP4 containers.",[],[],,1
11062,r2.18.5,closed,2023-03-14 17:57:36,2023-06-01 01:05:26,2023-03-22 09:49:38,,[],['tonihei'],,0
11061,Add DTSUHDSpecificBox (udts) support to parseAudioSampleEntry().,closed,2023-03-14 08:34:29,2023-05-16 01:05:28,2023-03-16 16:49:10,"Add DTSUHDSpecificBox (udts) support to parseAudioSampleEntry(). 'udts' box is defined in Table B-2 of
ETSI TS 103 491 V1.2.1 (2019-05) DTS-UHD Audio Format; Delivery of Channels, Objects and Ambisonic Sound Fields.
",['should merge'],['rohitjoins'],,0
11060,ExoPlayer - Player is accessed on the wrong thread with RxJava2,closed,2023-03-13 12:18:57,2023-05-14 01:05:00,2023-03-14 12:26:23,"From past developers, I got a large library, which is built on the basis of ExoPlayer, which allows you to listen to audio books.

Everything worked fine until the library itself had to update the version of ExoPlayer to a newer one (this was very important)

In short: there is a small interface that has a ProgressBar showing how many seconds the audio has already been playing. Here is the code for this:

```
private lateinit var mExoPlayer : ExoPlayer

private val compositeDisposable = CompositeDisposable()
private val currentTrackProgress = MutableLiveData<Long>()

private var currentTrackProgressDisposable : Disposable? = null
private val playbackProgressObservable : Observable<Long> =
    Observable.interval(1, TimeUnit.MILLISECONDS).map {
        mExoPlayer.currentPosition
    }.observeOn(AndroidSchedulers.mainThread())

////////////////////// So many code here
////////////////////// Somewhere there is a call to the ""createExoPlayer()"" function

private fun createExoPlayer() {
    mExoPlayer = ExoPlayer.Builder(this).build()

    mExoPlayer.addListener(object : Player.Listener {

        override fun onIsPlayingChanged(isPlaying : Boolean) {
            if (isPlaying) {
                currentTrackProgressDisposable = playbackProgressObservable.subscribeBy(
                    onError = { error ->
                        Log.d(""error"", error.toString())
                    },
                    onNext = { progress ->
                        currentTrackProgress.value = progress
                    }
                )
                compositeDisposable.add(currentTrackProgressDisposable!!)
            }
        }
    })

    mExoPlayer.playWhenReady = true
}
```
Before updating ExoPlayer version, everything worked fine, but after updating to the latest version, an error began to appear in onError:

java.lang.IllegalStateException: Player is accessed on the wrong thread.
Current thread: 'RxComputationThreadPool-7'
Expected thread: 'main'

```
java.lang.IllegalStateException: Player is accessed on the wrong thread.
Current thread: 'RxComputationThreadPool-7'
Expected thread: 'main'
See https://exoplayer.dev/issues/player-accessed-on-wrong-thread
     at com.google.android.exoplayer2.ExoPlayerImpl.verifyApplicationThread(ExoPlayerImpl.java:2668)
     at com.google.android.exoplayer2.ExoPlayerImpl.getCurrentPosition(ExoPlayerImpl.java:1058)
     at  xx.xx.xx.xxx.xxx..ExoBasePlayer.getCurrentPositionMs(Unknown Source:4)
     at  xx.xx.xx.xxx.xxx..AudioPlayer.getCurrentPosition(Unknown Source:2)
     at  xx.xx.xx.xxx.xxx..player.MediaSessionController.getCurrentPlaybackState(Unknown Source:2)
     at  xx.xx.xx.xxx.xxx..MediaSessionController.init$lambda-6(Unknown Source:82)
     at xx.xx.xx.xxx.xxx.MediaSessionController.$r8$lambda$VsMb3HHeQpuRrgGgnxPJqHRLzD8(Unknown Source:0)
     at xx.xxx.xx.xx.xx.xx.MediaSessionController$$ExternalSyntheticLambda4.apply(Unknown Source:4)
     at io.reactivex.internal.operators.observable.ObservableSwitchMap$SwitchMapObserver.onNext(ObservableSwitchMap.java:111)
     at io.reactivex.internal.operators.observable.ObservableFilter$FilterObserver.onNext(ObservableFilter.java:52)
     at io.reactivex.observers.SerializedObserver.onNext(SerializedObserver.java:111)
     at io.reactivex.internal.operators.observable.ObservableBufferTimed$BufferExactUnboundedObserver.accept(ObservableBufferTimed.java:213)
     at io.reactivex.internal.operators.observable.ObservableBufferTimed$BufferExactUnboundedObserver.accept(ObservableBufferTimed.java:81)
     at io.reactivex.internal.observers.QueueDrainObserver.fastPathEmit(QueueDrainObserver.java:69)
     at io.reactivex.internal.operators.observable.ObservableBufferTimed$BufferExactUnboundedObserver.run(ObservableBufferTimed.java:208)
     at io.reactivex.internal.schedulers.ScheduledDirectPeriodicTask.run(ScheduledDirectPeriodicTask.java:38)
     at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:463)
     at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)
     at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:308)
     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1137)
     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:637)
     at java.lang.Thread.run(Thread.java:1012)
```

What could be the reason for this and how to fix it? After all, I didn’t even update the RxJava2 version, but only updated ExoPlayer",['question'],['marcbaechinger'],,2
11059,Pixel 7/7 Pro freezes when repeating task switching while playing widevine content,open,2023-03-13 12:17:09,2023-07-25 21:37:56,,"### ExoPlayer Version

2.18.2

### Devices that reproduce the issue

* Pixel 7 running on Android 13 (TQ1A.230205.002)
* Pixel 7 Pro running on Android 13

### Devices that do not reproduce the issue

* Pixel 6 running on Android 13 (TQ1A.230205.002)

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Play `Widevine DASH (MP4, H264 > HD (cenc)` video
2. Until displayed recents screen swipe up the bottom of the screen
3. Tap ExoPlayer demo app
4. Repeat step 2 to 3

### Expected result

Continuous playback without freeze

### Actual result

Freeze UI and reboot device

### Media

`Widevine DASH (MP4, H264) > HD (cenc)`

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'bug: in platform drm']",['rrfrias'],,4
11058,seekTo restarts audio stream,open,2023-03-13 12:04:04,2023-03-14 11:19:56,,"I'm using ExoPlayer 2.11.8, but I tried the latest version as well, the result is the same I have an MP3 file on the server https://xp4stm90bvzr.frontroute.org/s02/images/audiobooks/1/8/1/files/01--glava-1.mp3, to access the file you need to specify headers user agent and referer = ""https://audiobook-mp3.com/"". When loading ProgressiveMediaSource sets isSeeking = false and isLive = true. Other files work fine. I already tried setting Mp3Extractor.FLAG_ENABLE_CONSTANT_BITRATE_SEEKING and setConstantBitrateSeekingEnabled = true didn't help",['question'],['marcbaechinger'],,9
11057,How to change FPS for preview,open,2023-03-13 01:15:43,2023-04-11 09:09:17,,"Hi team. I have a video encoder application that supports changing the FPS . I want to let the users of my app to encode a video with lower frame rate. But before encoding, I want to show that on preview. 
For example: the input video is 30FPS but I want to show the preview with 5FPS before encoding. I have followed the @krocard 's instruction here https://github.com/google/ExoPlayer/issues/8667#issuecomment-790507081
So I created the `DropMediaCodecVideoRenderer`
```
class DropMediaCodecVideoRenderer :
    MediaCodecVideoRenderer {

    constructor (
        context: Context,
        codecAdapterFactory: MediaCodecAdapter.Factory,
        mediaCodecSelector: MediaCodecSelector,
        allowedJoiningTimeMs: Long,
        enableDecoderFallback: Boolean,
        eventHandler: Handler,
        eventListener: VideoRendererEventListener,
        maxDroppedFramesToNotify: Int
    ) : super(
        context,
        codecAdapterFactory,
        mediaCodecSelector,
        allowedJoiningTimeMs,
        enableDecoderFallback,
        eventHandler,
        eventListener,
        maxDroppedFramesToNotify
    )

    private var outputBufferBeforeDownsamplingDropCount = 0

    override fun onProcessedOutputBuffer(presentationTimeUs: Long) {
        super.onProcessedOutputBuffer(presentationTimeUs)
    }
    override fun processOutputBuffer(
        positionUs: Long,
        elapsedRealtimeUs: Long,
        codec: MediaCodecAdapter?,
        buffer: ByteBuffer?,
        bufferIndex: Int,
        bufferFlags: Int,
        sampleCount: Int,
        bufferPresentationTimeUs: Long,
        isDecodeOnlyBuffer: Boolean,
        isLastBuffer: Boolean,
        format: Format
    ): Boolean {
        if (isDecodeOnlyBuffer) return super.processOutputBuffer(
            positionUs,
            elapsedRealtimeUs,
            codec,
            buffer,
            bufferIndex,
            bufferFlags,
            sampleCount,
            bufferPresentationTimeUs,
            true,
            isLastBuffer,
            format
        )

        val shouldDrop = ((this.outputBufferBeforeDownsamplingDropCount++) % 6) != 0 // drop 5/6 of frames
        return super.processOutputBuffer(
            positionUs,
            elapsedRealtimeUs,
            codec,
            buffer,
            bufferIndex,
            bufferFlags,
            sampleCount,
            bufferPresentationTimeUs,
            shouldDrop,
            isLastBuffer,
            format
        )
    }

}
```
`CustomRenderersFactory`

```
class CustomRenderersFactory(context: Context): DefaultRenderersFactory(context) {


    override fun buildVideoRenderers(
        context: Context,
        extensionRendererMode: Int,
        mediaCodecSelector: MediaCodecSelector,
        enableDecoderFallback: Boolean,
        eventHandler: Handler,
        eventListener: VideoRendererEventListener,
        allowedVideoJoiningTimeMs: Long,
        out: java.util.ArrayList<Renderer>
    ) {
        val videoRenderer = DropMediaCodecVideoRenderer(
            context,
            codecAdapterFactory,
            mediaCodecSelector,
            allowedVideoJoiningTimeMs,
            enableDecoderFallback,
            eventHandler,
            eventListener,
            50
        )
        out.add(videoRenderer)
    }
}
```

`PlayMovieActivity`

```
val exoPlayer = ExoPlayer.Builder(this)
            .setTrackSelector(DefaultTrackSelector(this))
            .setRenderersFactory(CustomRenderersFactory(this))
            .build()
        val videoUri = Uri.parse(""asset:///video_test2.mp4"")
        val videoItem = MediaItem.fromUri(videoUri)
        exoPlayer.addMediaItem(videoItem)

        binding.playerView.player = exoPlayer
        // Prepare the player.
        exoPlayer.prepare()
        exoPlayer.playWhenReady = true
        exoPlayer.volume = 0f
        // Start the playback.
        exoPlayer.play()
```

But all I got is a black screen. Could anyone tell me how to custom the fps in exoplayer for preview?
",['question'],['tof-tof'],,5
11056,Failed to connect to xxxx.xxxx.xxx/127.0.0.1:443,closed,2023-03-11 23:55:20,2023-06-11 01:05:12,2023-04-11 01:06:02,"the URL I catch from website and then do  -> exoplayer.loadUrl
normal m3u8 or mp4 url was fine to palyer on my code
the problem is the URL will by using HTTP CONNECT METHOD ,
it starts with “https://”    Redirect to xxxx.xxxx.xxx/127.0.0.1:443
and I uses none pre-setting DefaultHttpDataSource.Factory()
by the way,  the URL has ""token"" and ""expire"" key,  but I use IDM downloader was ok to download in time ,it's a mp4 file.
hlep!","['question', 'closed-by-bot']",['marcbaechinger'],,3
11055,Incorrect audioFormat data,open,2023-03-11 15:06:13,2023-03-16 16:50:55,,"Hi. I need to retrieve infrormation from currently playing audio stream. I get It like this :
`val format = exoPlayer.audioFormat`
`val sampleRate = format?.sampleRate ?: 0`
`val channels = format?.channelCount ?: 0`

For some streams (maybe most part) it is correct. 
Sometimes though it says 22050, 1 channel, when in fact it is 44100 and 2 channels. 
In other cases when it says 24000 2 channels, in fact it is 48000 2 channels
When it is incorrect, it is consistent for particular streams. 

Is there another way to determine this information of format inside exoplayer, or am I doing it wrong? 

**ALSO**
Seems, when format sampleMimeType is audio/mp4a-latm, it is usually incorrect. ",['enhancement'],['marcbaechinger'],,4
11054,Audio Sink error,closed,2023-03-10 16:59:05,2023-05-16 01:05:28,2023-03-16 07:55:16,"On one of the HLS stream I am getting Audio Sink error from the time to time.

```
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer: Audio sink error
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:   com.google.android.exoplayer2.audio.AudioSink$UnexpectedDiscontinuityException: Unexpected audio track timestamp discontinuity: expected 1005666327999, got 1005670294666
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at com.google.android.exoplayer2.audio.DefaultAudioSink.handleBuffer(DefaultAudioSink.java:998)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at com.google.android.exoplayer2.audio.MediaCodecAudioRenderer.processOutputBuffer(MediaCodecAudioRenderer.java:703)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.drainOutputBuffer(MediaCodecRenderer.java:1894)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(MediaCodecRenderer.java:792)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:989)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:490)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at android.os.Handler.dispatchMessage(Handler.java:102)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at android.os.Looper.loopOnce(Looper.java:201)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at android.os.Looper.loop(Looper.java:288)
03-10 19:36:25.482  3049  3986 E MediaCodecAudioRenderer:       at android.os.HandlerThread.run(HandlerThread.java:67)
```

What does it mean by ` Unexpected audio track timestamp discontinuity`.
Is it due to stream or missing somethink in exoplayer implementation?","['question', 'need more info']",['marcbaechinger'],,2
11053,Read current backBuffer duration,open,2023-03-10 11:33:17,2023-03-10 16:14:45,,"Hi,
Is there anyway to read the current duration of the backBuffer, not the configured value, but the amount already filled by the player.
I've seen the same question here https://github.com/google/ExoPlayer/issues/10190#issuecomment-1113471509 but didn't find an answer.
Also looked in the code but couldn't find a way to do it.

Thanks in advance.","['question', 'needs triage']",['rohitjoins'],,0
11052,Proper way to add custom buttons in StyledPlayerView?,closed,2023-03-10 03:13:56,2023-05-10 01:05:32,2023-03-10 11:42:03,"I'm trying to add a new button which opens a dialog, which lists avaliable video qualities in current stream.  
First I've copied `exo_styled_player_control_view.xml` and added an ImageButton.
```xml
<!-- ... -->
<FrameLayout android:id=""@id/exo_controls_background""
      android:layout_width=""0dp""
      android:layout_height=""0dp""
      tools:layout_width=""match_parent""
      tools:layout_height=""match_parent""
      android:background=""#98000000"">

  <ImageButton
      android:id=""@+id/exo_video_quality_button""
      android:layout_width=""48dp""
      android:layout_height=""48dp""
      android:layout_gravity=""top|end""
      android:layout_marginTop=""16dp""
      android:layout_marginEnd=""16dp""
      android:background=""?attr/selectableItemBackgroundBorderless""
      android:clickable=""true""
      android:focusable=""true""
      app:srcCompat=""@drawable/baseline_speed_24""
      app:tint=""@color/white""/>
</FrameLayout>
<!-- ... -->
```

To set onClick behaviour of this button, next I've created `MyStyledPlayerView` which extends StyledPlayerView.
```Kotlin
class MyStyledPlayerView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    @AttrRes defStyleAttr: Int = 0
) : StyledPlayerView(context, attrs, defStyleAttr) {

    private var controlView: StyledPlayerControlView? = null
    private var resolutionButton: ImageButton? = null

    init {
        controlView = findViewById(com.google.android.exoplayer2.ui.R.id.exo_controller)
        resolutionButton = controlView?.findViewById<ImageButton>(R.id.exo_video_quality_button)
        resolutionButton?.setOnClickListener {
            Log.e(""MyStyledPlayerView"",""It Works!"")
        }
    }
}
```

Finally, I've added `MyStyledPlayerView` in my activity layout.
```xml
<?xml version=""1.0"" encoding=""utf-8""?>
<layout xmlns:tools=""http://schemas.android.com/tools""
    xmlns:android=""http://schemas.android.com/apk/res/android""
    xmlns:app=""http://schemas.android.com/apk/res-auto"">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:id=""@+id/root_view""
        android:layout_width=""match_parent""
        android:layout_height=""match_parent""
        android:background=""@color/black""
        android:animateLayoutChanges=""true""
        tools:context="".MainActivity"">

        <com.devingryu.streamingtest.tools.MyStyledPlayerView
            android:id=""@+id/player_view""
            android:layout_width=""0dp""
            android:layout_height=""0dp""
            app:layout_constraintBottom_toBottomOf=""parent""
            app:layout_constraintEnd_toEndOf=""parent""
            app:layout_constraintStart_toStartOf=""parent""
            app:layout_constraintTop_toTopOf=""parent""
            app:resize_mode=""fit""
            app:show_buffering=""when_playing""
            app:show_subtitle_button=""true""
            app:controller_layout_id=""@layout/exo_custom_control""/>

    </androidx.constraintlayout.widget.ConstraintLayout>
</layout>
```

Actually, this method works pretty well. However I think this is somewhat complicated, since I just want to add single custom button to control.  
Soulution would be much simplified if I can access control view in my activity, but unfortunately `control` is private in `StyledPlayerView`. I've also tried this method to access control,

```xml
<?xml version=""1.0"" encoding=""utf-8""?>
<layout xmlns:tools=""http://schemas.android.com/tools""
    xmlns:android=""http://schemas.android.com/apk/res/android""
    xmlns:app=""http://schemas.android.com/apk/res-auto"">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:id=""@+id/root_view""
        android:layout_width=""match_parent""
        android:layout_height=""match_parent""
        android:background=""@color/black""
        android:animateLayoutChanges=""true""
        tools:context="".MainActivity"">

        <com.devingryu.streamingtest.tools.MyStyledPlayerView
            android:id=""@+id/player_view""
            android:layout_width=""0dp""
            android:layout_height=""0dp""
            app:layout_constraintBottom_toBottomOf=""parent""
            app:layout_constraintEnd_toEndOf=""parent""
            app:layout_constraintStart_toStartOf=""parent""
            app:layout_constraintTop_toTopOf=""parent""
            app:resize_mode=""fit""
            app:show_buffering=""when_playing""
            app:show_subtitle_button=""true""
            app:use_controller=""false"" />

        <com.google.android.exoplayer2.ui.StyledPlayerControlView
            android:id=""@+id/player_control""
            android:layout_width=""0dp""
            android:layout_height=""0dp""
            app:controller_layout_id=""@layout/exo_custom_control""
            app:layout_constraintBottom_toBottomOf=""@id/player_view""
            app:layout_constraintEnd_toEndOf=""@id/player_view""
            app:layout_constraintStart_toStartOf=""@id/player_view""
            app:layout_constraintTop_toTopOf=""@id/player_view"" />

    </androidx.constraintlayout.widget.ConstraintLayout>
</layout>
```
and run `binding.player_control.player = player` on init. But StyledPlayerView is unable to recognize control, so control doesn't show up when I touch screen.

Are there any better solution for this task?

Thanks in advance.",['question'],['icbaker'],,1
11051,Removes liveOffsetTarget override on seek to live edge,closed,2023-03-10 00:06:16,2023-06-01 01:05:26,2023-03-31 10:43:03,"Any calls that issue a `seekTo()` where the position is `TIME_UNSET` will now restore the live offset target to the MediaItem set default.

The code handles an intra-period seek in the same timeline by simply updating or removing the `setTargetLiveOffsetOverrideUs()`.  Other cases call the original code.

This fixes issue #11050",[],['marcbaechinger'],,1
11050,Seek to default live does not restore idealTargetLiveOffset,closed,2023-03-09 23:14:23,2023-08-07 17:04:42,2023-08-07 17:04:42,"### ExoPlayer Version

2.18.4

### Devices that reproduce the issue

* SEI500 SEI Robotics (AmLogic SoC STB) running Android 29
* Probably everything else with AAC audio

### Devices that do not reproduce the issue

None I'm aware of.

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Play live stream with non-default `LiveConfiguration`
2. Seek back (jump back 5 button) a few times, notice `setTargetLiveOffsetOverrideUs()` is called to move the target (not sure why this is a feature, IMO live adjustment should shut off here until seek back to live edge)
3. call `seekTo(C.TIME_UNSET)` (from the UI play next button with no next item will do this.

### Expected result

Live adjustment resumes (continues) using the original target set on playback startup (`mediaConfigurationTargetLiveOffsetUs`)

### Actual result

Playback seeks to the live edge, but Live adjustment desperately tries to move **back** to the last non default seek.

Logging shows clearly what is happening:

Step 1 - normal startup and live adjustment

````
03-09 14:47:30.744 20204 20204 I ExoPlayerImpl: Init c9a8d43 [ExoPlayerLib/2.18.3] [SEI500RCN, Pyxis-RCN, SEI Robotics, 29]
03-09 14:47:31.665 20204 21891 D DefaultLivePlaybackSpeedControl: setLiveConfiguration(LiveConfiguration - min/max speed: 0.9/1.1 targetOffset: 33284) - updated
03-09 14:47:33.414 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 1.1 liveOffsetUs: 38107723 currentTargetLiveOffsetUs: 33284000 idealTargetLiveOffsetUs: 33284000 smoothedMinPossibleLiveOffsetUs: 32112240
````

Step 2 - three back button presses jump back 15 seconds total, override is called (`setTargetLiveOffsetOverrideUs()`)

````
03-09 14:48:02.377 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: 3575642000
03-09 14:48:02.378 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3599666000
03-09 14:48:02.379 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3599666000 seekTargetWindow.defaultPositionUs: 3573570000 playbackInfo.positionUs 3604666116 requestedContentPositionUs: 3599666000
03-09 14:48:02.430 20204 21891 D DefaultLivePlaybackSpeedControl: setTargetLiveOffsetOverrideUs(41042000)
03-09 14:48:03.035 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: 3564636000
03-09 14:48:03.035 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3594666000
03-09 14:48:03.036 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3594666000 seekTargetWindow.defaultPositionUs: 3573570000 playbackInfo.positionUs 3599666000 requestedContentPositionUs: 3594666000
03-09 14:48:03.085 20204 21891 D DefaultLivePlaybackSpeedControl: setTargetLiveOffsetOverrideUs(46697000)
03-09 14:48:03.832 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: 3559636000
03-09 14:48:03.832 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3589666000
03-09 14:48:03.832 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3589666000 seekTargetWindow.defaultPositionUs: 3573570000 playbackInfo.positionUs 3594666000 requestedContentPositionUs: 3589666000
03-09 14:48:03.865 20204 21891 D DefaultLivePlaybackSpeedControl: setTargetLiveOffsetOverrideUs(52477000)
03-09 14:48:05.323 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 1.1 liveOffsetUs: 53930908 currentTargetLiveOffsetUs: 52477000 idealTargetLiveOffsetUs: 52477000 smoothedMinPossibleLiveOffsetUs: 48192019
03-09 14:48:06.328 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 1.1 liveOffsetUs: 53941958 currentTargetLiveOffsetUs: 52477000 idealTargetLiveOffsetUs: 52477000 smoothedMinPossibleLiveOffsetUs: 47873236

````

Step 3 - seek default is executed (prepare() will do this as well), notice `setTargetLiveOffsetOverrideUs(C.TIME_UNSET)` is **not called** so adjustment reverses trying (incorrectly) to slow down to the old seek position

````
03-09 14:48:18.337 20204 21891 D ExoPlayerImplInternal: seekToInternal() - timeline empty: false  seekPosition.windowPositionUs: -9223372036854775807
03-09 14:48:18.337 20204 21891 D ExoPlayerImplInternal: resolvedSeekPosition periodUid: Pair{java.lang.Object@9be3c3e java.lang.Object@c575286} resolvedContentPositionUs: 3621618011
03-09 14:48:18.338 20204 21891 D ExoPlayerImplInternal: before seekToPeriodPosition() - newPeriodPositionUs: 3621618011 seekTargetWindow.defaultPositionUs: 3579576000 playbackInfo.positionUs 3603559763 requestedContentPositionUs: -9223372036854775807
03-09 14:48:19.126 20204 21891 D DefaultLivePlaybackSpeedControl: adjusting offset, speed: 0.9 liveOffsetUs: 35776574 currentTargetLiveOffsetUs: 52745177 idealTargetLiveOffsetUs: 52477000 smoothedMinPossibleLiveOffsetUs: 28691196
````


### Media

Will send a live test stream to the developer email.

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug'],['marcbaechinger'],,6
11049,Exoplayer - DRM contents(Mpeg Dash) issue,closed,2023-03-09 19:57:01,2023-05-15 01:05:28,2023-03-15 09:55:46,"**ExoPlayer Version**
2.18.1

**Devices that reproduce the issue**
Recent Android devices

**Devices that do not reproduce the issue**
No response

**Reproducible in the demo app?**
No

**Reproduction steps**
Play DRM contents (multi period Dash)

**Expected result**
Media plays successfully without any issues.

**Actual result**
IllegalArgumentException

Some DRM(widevine) contents are not playing.
According to your docs, 
<img width=""897"" alt=""image"" src=""https://user-images.githubusercontent.com/7144761/224139475-80edd265-36d1-4a88-a4a9-e83b676d254a.png"">
**DefaultMediaSourceFactory** does not support sideloading subtitles for multi-period DASH.

Then is it way to resolve this issue?
Followings are drm contents I'm testing with.


- ExoPlayer version : 2.18.1

- Contents DRM Contents (WideVine)
- source url: `https://hls.ondemandkorea.com/kcp-content-ingest/processing/EP00013-The-Penthouse-2-70762578-2023-01-12-08-43-14.mp4/WideVine/bumper/kcp_master_1080p.mpd`
- drmtoday url : `https://lic.drmtoday.com/license-proxy-widevine/cenc/`
- merchant: `odkmedia`
- assetId : `662e4bd1c8f0c6c71d7c32819d806427af1cf08eb1eea1bb3c0dc3afe010eba1`
- variantId : `staging`
- userId : `7e2f9a23-e1b9-46c0-b804-d7d9760c3887`
- session id : `eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzZXJ2aWNlX25hbWUiOiJvZGsiLCJlcGlzb2RlX2lkIjo4NDE1MjMsImVuY3J5cHRpb25faWQiOiI2NjJlNGJkMWM4ZjBjNmM3MWQ3YzMyODE5ZDgwNjQyN2FmMWNmMDhlYjFlZWExYmIzYzBkYzNhZmUwMTBlYmExIiwiZHJtX3Nlc3Npb24iOiI3ZTJmOWEyMy1lMWI5LTQ2YzAtYjgwNC1kN2Q5NzYwYzM4ODcifQ.AkvF7zP3TP35GhDNEZZstu11yJqliY_FQvvGSSMcu-Q`


**Error Message**
`11:54:02.259 LoadTask                 E  Unexpected exception handling load completed
                                           java.lang.IllegalArgumentException
                                               at com.google.android.exoplayer2.util.Assertions.checkArgument(Assertions.java:39)
                                               at com.google.android.exoplayer2.source.ads.AdsMediaSource.onChildSourceInfoRefreshed(AdsMediaSource.java:266)
                                               at com.google.android.exoplayer2.source.ads.AdsMediaSource.onChildSourceInfoRefreshed(AdsMediaSource.java:61)
                                               at com.google.android.exoplayer2.source.CompositeMediaSource.lambda$prepareChildSource$0$com-google-android-exoplayer2-source-CompositeMediaSource(CompositeMediaSource.java:115)
                                               at com.google.android.exoplayer2.source.CompositeMediaSource$$ExternalSyntheticLambda0.onSourceInfoRefreshed(Unknown Source:4)
                                               at com.google.android.exoplayer2.source.BaseMediaSource.refreshSourceInfo(BaseMediaSource.java:88)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource.processManifest(DashMediaSource.java:847)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource.onManifestLoadCompleted(DashMediaSource.java:624)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource$ManifestCallback.onLoadCompleted(DashMediaSource.java:1302)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource$ManifestCallback.onLoadCompleted(DashMediaSource.java:1297)
                                               at com.google.android.exoplayer2.upstream.Loader$LoadTask.handleMessage(Loader.java:478)
                                               at android.os.Handler.dispatchMessage(Handler.java:106)
                                               at android.os.Looper.loopOnce(Looper.java:226)
                                               at android.os.Looper.loop(Looper.java:313)
                                               at android.os.HandlerThread.run(HandlerThread.java:67)
11:54:02.263 ExoPlayerImplInternal    E  Playback error
                                           com.google.android.exoplayer2.ExoPlaybackException: Source error
                                               at com.google.android.exoplayer2.ExoPlayerImplInternal.handleIoException(ExoPlayerImplInternal.java:632)
                                               at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:608)
                                               at android.os.Handler.dispatchMessage(Handler.java:102)
                                               at android.os.Looper.loopOnce(Looper.java:226)
                                               at android.os.Looper.loop(Looper.java:313)
                                               at android.os.HandlerThread.run(HandlerThread.java:67)
                                           Caused by: com.google.android.exoplayer2.upstream.Loader$UnexpectedLoaderException: Unexpected IllegalArgumentException: null
                                               at com.google.android.exoplayer2.upstream.Loader$LoadTask.handleMessage(Loader.java:482)
                                               at android.os.Handler.dispatchMessage(Handler.java:106)
                                               at android.os.Looper.loopOnce(Looper.java:226) 
                                               at android.os.Looper.loop(Looper.java:313) 
                                               at android.os.HandlerThread.run(HandlerThread.java:67) 
                                           Caused by: java.lang.IllegalArgumentException
                                               at com.google.android.exoplayer2.util.Assertions.checkArgument(Assertions.java:39)
                                               at com.google.android.exoplayer2.source.ads.AdsMediaSource.onChildSourceInfoRefreshed(AdsMediaSource.java:266)
                                               at com.google.android.exoplayer2.source.ads.AdsMediaSource.onChildSourceInfoRefreshed(AdsMediaSource.java:61)
                                               at com.google.android.exoplayer2.source.CompositeMediaSource.lambda$prepareChildSource$0$com-google-android-exoplayer2-source-CompositeMediaSource(CompositeMediaSource.java:115)
                                               at com.google.android.exoplayer2.source.CompositeMediaSource$$ExternalSyntheticLambda0.onSourceInfoRefreshed(Unknown Source:4)
                                               at com.google.android.exoplayer2.source.BaseMediaSource.refreshSourceInfo(BaseMediaSource.java:88)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource.processManifest(DashMediaSource.java:847)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource.onManifestLoadCompleted(DashMediaSource.java:624)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource$ManifestCallback.onLoadCompleted(DashMediaSource.java:1302)
                                               at com.google.android.exoplayer2.source.dash.DashMediaSource$ManifestCallback.onLoadCompleted(DashMediaSource.java:1297)
                                               at com.google.android.exoplayer2.upstream.Loader$LoadTask.handleMessage(Loader.java:478)
                                               at android.os.Handler.dispatchMessage(Handler.java:106) 
                                               at android.os.Looper.loopOnce(Looper.java:226) 
                                               at android.os.Looper.loop(Looper.java:313) 
                                               at android.os.HandlerThread.run(HandlerThread.java:67) `
",['duplicate'],['tonihei'],,2
11048,Square/Vertical content overlaps with ads in emulator,closed,2023-03-09 03:44:25,2023-08-23 01:05:11,2023-06-23 12:28:19,"### ExoPlayer Version

2.17.1

### Devices that reproduce the issue

- Emulator Pixel 5 running Android 13

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Play any vertical/square content with horizontal ads

### Expected result

Ads should disappear and content can be shown without overlapping to any ads

### Actual result

Content shown on top of the ads (overlapping)
![Screenshot from 2023-03-09 10-39-58](https://user-images.githubusercontent.com/6689845/223910757-b7fd452b-c2bd-4d01-8890-ff46f4da2051.png)


### Media

Media sample used will be sent through email

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug: device specific'],['tonihei'],,6
11047,ExoPlayer Live Video Latency,closed,2023-03-08 19:37:42,2023-08-01 01:05:07,2023-06-01 01:05:38,"I have a laptop encoding video and sending it to my android phone.  I developed an app using ExoPlayer to play the video ( I was using ffmpeg ).  ExoPlayer always has a latency of about 4.5 seconds between when something happens and the video shows the action on the phone.  I have tried several APIs and options that relate to buffering but no luck decreasing this latency.  If anyone knows how to decrease this latency,  I would appreciate any pointers.
Thanks
Y-
","['question', 'closed-by-bot']",['christosts'],,10
11046,MediaSource wrapping a MediaItem drops the ad config,closed,2023-03-08 18:24:39,2023-05-08 01:05:22,2023-03-08 18:45:40,"### ExoPlayer Version

2.18.4

### Devices that reproduce the issue

All Android devices tested, including those running Android 11, 12, and 13.

### Devices that do not reproduce the issue

All tested devices reproduced the issue.

### Reproducible in the demo app?

Yes

### Reproduction steps

The simplest way to reproduce this is to check out https://github.com/googleads/googleads-ima-android and modify exoplayerexample/MyActivity.java as shown in this PR: https://github.com/Human/googleads-ima-android/pull/1

### Expected result

We expect the preroll ad configured with `MediaItem.setAdsConfiguration()` to play, followed by the ""regular"" stream content as set by `MediaItem.setUri()`.

### Actual result

The preroll ad configured with `MediaItem.setAdsConfiguration()` is not played, but the ""regular"" stream content as set by `MediaItem.setUri()` does play.

### Media

https://github.com/Human/googleads-ima-android/pull/1 uses the reference media inside the reference project for the IMA SDK.

### Bug Report

- [x] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['wont fix: app issue'],['marcbaechinger'],,2
11045,Set DataSource takes too much time,closed,2023-03-08 15:53:07,2023-05-08 01:05:23,2023-03-08 17:59:07,"### ExoPlayer Version

2.18.4

### Devices that reproduce the issue

Set datasource takes much time because of initial buffering. Even reducing the numbers doesn't mitigate the issue.  On iOS with AVPlayer I can setup datasource and be ready to play() in less than 1sec. With ExoPlayer it takes from 3 to 6sec, see vid below.

In this video I switch between two different urls but the play icon is shown after much time. Playback works, it is just a matter of long setup time.
https://user-images.githubusercontent.com/53510751/223759302-826f2162-a7a6-4cdb-90a0-907a1a6a8676.mp4


### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Code is basic, here is my values for buffering:
    init {
        val loadBuilder = DefaultLoadControl.Builder()
        loadBuilder.setBufferDurationsMs(
                50,
                13107200,
                30,
                30
        )
        loadControl = loadBuilder.build()
        exoPlayer = ExoPlayer.Builder(context)
                .setTrackSelector(trackSelector)
                .setLoadControl(loadControl)
                .build()

### Expected result

This is the expected result, I'm achieving this on iOS with AVPlayer.

https://user-images.githubusercontent.com/53510751/223760869-047da357-14bc-43b3-8c05-5a013e49d2cf.mp4



### Actual result

Actual result with ExoPlayer, I'm testing on Xiaomi Mi Lite 5G
https://user-images.githubusercontent.com/53510751/223759302-826f2162-a7a6-4cdb-90a0-907a1a6a8676.mp4

### Media

I'm using following urls in my demo.
url1 = 'https://d305e11xqcgjdr.cloudfront.net/stories/4cf90380-e814-4f74-aac0-250a7b2cbaac/4.mp4';
url2 = 'https://d305e11xqcgjdr.cloudfront.net/stories/61cc00f1-6e16-4015-b92d-e34e55e28742/13.mp4';

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'needs triage']",[],,1
11044,MediaCodecAudioRenderer error audio/mpeg-L2,closed,2023-03-08 13:39:11,2023-06-07 01:05:47,2023-04-07 01:05:46,"```
E/ExoPlayerImplInternal: Playback error
      com.google.android.exoplayer2.ExoPlaybackException: MediaCodecAudioRenderer error, index=1, format=Format(1/4, null, null, audio/mpeg-L2, null, -1, null, [-1, -1, -1.0], [2, 48000]), format_supported=NO_UNSUPPORTED_TYPE
```
      
a strange error, on version 2.16.1 in some applications it reproduces HlsMediaResource and on 2.18.4 it does not reproduce anywhere at all.","['question', 'closed-by-bot']",['rohitjoins'],,3
11043,Unexpected audio track timestamp discontinuity,closed,2023-03-07 10:57:56,2023-05-09 01:05:23,2023-03-09 01:22:01,"This problem occurs when I play the following video, how can I bypass this timestamp check？

<img width=""872"" alt=""image"" src=""https://user-images.githubusercontent.com/16680840/223402888-2104bfc0-d811-41be-81c4-0508dd4335c5.png"">


<img width=""1328"" alt=""image"" src=""https://user-images.githubusercontent.com/16680840/223402458-dcf0c3fc-7835-4d49-85fa-8759a1f45980.png"">","['question', 'needs triage']",['rohitjoins'],,5
11042,Can you support any video decoder that ffmpeg supports？,closed,2023-03-07 07:28:08,2023-05-07 01:05:03,2023-03-07 13:03:32,"Can you support any video decoder that ffmpeg supports？

example：
# ./configure  --list-decoders
aac                     dxa                     mp2                     s302m
aac_at                  dxtory                  mp2_at                  sami
aac_fixed               dxv                     mp2float                sanm
aac_latm                eac3                    mp3                     sbc
aasc                    eac3_at                 mp3_at                  scpr
...


",['enhancement'],['rohitjoins'],,1
11041,STATE_READY not triggering,closed,2023-03-06 17:31:42,2023-05-15 01:05:29,2023-03-15 14:48:12,"### ExoPlayer Version

2.18.4

### Devices that reproduce the issue

- Android 9 TV Emulator
- Set-up box running on Android 9

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Play the attached media in the demo app

### Expected result

The media plays successfully

### Actual result

- Stream is stuck on loading
- `vfpo` is stuck on N/A, sib, sb, rb, db, mcdb, and dk is stuck on 0
- VLC can play the stream OK

### Media

Will email the stream URL to dev.exoplayer@gmail.com

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['question'],['tianyif'],,2
11040,Multicast stream get stuck with no error,open,2023-03-06 14:07:14,2023-05-03 06:04:47,,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Smartlabs

### Devices that do not reproduce the issue

NA

### Reproducible in the demo app?

Yes

### Reproduction steps

play a multicsat stream when connected to a multicast supported network
same streams sometimes get stuck and sometimes work when switching between them

### Expected result

Stream starts playing

### Actual result

Stream is stuck randomly after it worked previously, meaning, we played it, changed to other streams and came back to this one and suddenly it is stuck

We observed in the logs errors from codec `OMX.amlogic.avc.decoder.awesome2` 
We tried to troubleshoot the issue - we excluded `c2.android.aac.decoder` codec and it actually helped to eliminate the issue, streams stopped getting stuck, but this is not a viable solution cause it is on account of having no audio due to excluding of codec. 
Side note - also surprisingly, removing the codec helped make the streams loading time a lot faster.

here are some strange lines from logs if multicast is not loaded:
```
Access denied finding property ""media.omx.width""
type=1400 audit(0.0:790): avc: denied { read } for name=""u:object_r:default_prop:s0"" dev=""tmpfs"" ino=1004 scontext=u:r:mediacodec:s0 tcontext=u:object_r:default_prop:s0 tclass=file permissive=0
setParameter(0xf083e4d0:amlogic.avc.decoder.awesome2, OMX.google.android.index.allocateNativeHandle(0x7f00000a): Output:1 en=0) ERROR: UnsupportedSetting(0x80001019)
setParameter(0xf083e4d0:amlogic.avc.decoder.awesome2, OMX.google.android.index.storeMetaDataInBuffers(0x7f000002): Output:1 en=1 type=1) ERROR: BadPortIndex(0x8000101b)
```
what I can see is that by default native buffer info is w:640, h:480 and then some errors while setting resolution:
```
Access denied finding property ""media.omx.width""
Access denied finding property ""media.omx.height""
```
and then
```
setConfig(0xf083e4d0:amlogic.avc.decoder.awesome2, ConfigPriority(0x6f800002)) ERROR: UnsupportedIndex(0x8000101a)
ACodec                  
com.kaltura.playkitdemo              I  codec does not support config priority (err -1010)
```

### Media

The stream is multicast and can only be tested on multicast network, so can't share working example

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'needs triage']",['christosts'],,21
11039,Can't read webvtt  in webm file,open,2023-03-06 09:12:49,2023-04-09 18:24:52,,"Hi,
    I have a webm file. It has an subtitle stream by webvtt format. But Exoplayer can't find it.

#### THE VIDEO INFO:
```
Input #0, matroska,webm, from 'a1.webm':
  Metadata:
    ENCODER         : Lavf59.27.100
  Duration: 00:01:59.69, start: -0.006000, bitrate: 2762 kb/s
  Stream #0:0: Video: vp9 (Profile 0), yuv420p(tv, progressive), 1920x1080, SAR 1:1 DAR 16:9, 25 fps, 25 tbr, 1k tbn (default)
    Metadata:
      BPS-eng         : 8169907
      DURATION-eng    : 00:41:52.280000000
      NUMBER_OF_FRAMES-eng: 62807
      NUMBER_OF_BYTES-eng: 2565636839
      _STATISTICS_WRITING_APP-eng: mkvmerge v25.0.0 ('Prog Noir') 64-bit
      _STATISTICS_WRITING_DATE_UTC-eng: 2018-09-07 00:24:14
      _STATISTICS_TAGS-eng: BPS DURATION NUMBER_OF_FRAMES NUMBER_OF_BYTES
      ENCODER         : Lavc59.37.100 libvpx-vp9
      DURATION        : 00:01:59.120000000
  Stream #0:1(eng): Audio: opus, 48000 Hz, stereo, fltp (default)
    Metadata:
      BPS-eng         : 640000
      DURATION-eng    : 00:41:52.320000000
      NUMBER_OF_FRAMES-eng: 78510
      NUMBER_OF_BYTES-eng: 200985600
      _STATISTICS_WRITING_APP-eng: mkvmerge v25.0.0 ('Prog Noir') 64-bit
      _STATISTICS_WRITING_DATE_UTC-eng: 2018-09-07 00:24:14
      _STATISTICS_TAGS-eng: BPS DURATION NUMBER_OF_FRAMES NUMBER_OF_BYTES
      ENCODER         : Lavc59.37.100 libopus
      DURATION        : 00:01:59.688000000
  Stream #0:2(eng): Subtitle: webvtt (default)
    Metadata:
      title           : English
      ENCODER         : Lavc59.37.100 webvtt
      DURATION        : 00:01:55.514000000
```

#### THE EXOPLAYER LOG:

```
I/ExoPlayerImpl: Init cf736eb [ExoPlayerLib/2.18.4] [redfin, Pixel 5, Google, 33]
D/EventLogger: playWhenReady [eventTime=0.00, mediaPos=0.00, window=0, true, USER_REQUEST]
D/EventLogger: surfaceSize [eventTime=0.00, mediaPos=0.00, window=0, 0, 0]
D/EventLogger: timeline [eventTime=0.00, mediaPos=0.00, window=0, periodCount=1, windowCount=1, reason=PLAYLIST_CHANGED
D/EventLogger:   period [?]
D/EventLogger:   window [?, seekable=false, dynamic=true]
D/EventLogger: ]
D/EventLogger: mediaItem [eventTime=0.00, mediaPos=0.00, window=0, reason=PLAYLIST_CHANGED]
D/EventLogger: state [eventTime=0.00, mediaPos=0.00, window=0, BUFFERING]
E/OpenGLRenderer: Unable to match the desired swap behavior.
D/EventLogger: surfaceSize [eventTime=0.03, mediaPos=0.00, window=0, 1080, 2138]
E/SurfaceSyncer: Failed to find sync for id=0
W/Parcel: Expecting binder but got null!
D/EventLogger: loading [eventTime=0.03, mediaPos=0.00, window=0, period=0, true]
D/EventLogger: timeline [eventTime=0.03, mediaPos=0.00, window=0, period=0, periodCount=1, windowCount=1, reason=SOURCE_UPDATE
D/EventLogger:   period [?]
D/EventLogger:   window [?, seekable=false, dynamic=false]
D/EventLogger: ]
D/EventLogger: timeline [eventTime=0.33, mediaPos=0.00, window=0, period=0, periodCount=1, windowCount=1, reason=SOURCE_UPDATE
D/EventLogger:   period [2512.33]
D/EventLogger:   window [2512.33, seekable=true, dynamic=false]
D/EventLogger: ]
D/EventLogger: videoEnabled [eventTime=0.33, mediaPos=0.00, window=0, period=0]
D/EventLogger: audioEnabled [eventTime=0.33, mediaPos=0.00, window=0, period=0]
D/EventLogger: tracks [eventTime=0.33, mediaPos=0.00, window=0, period=0
D/EventLogger:   group [
D/EventLogger:     [X] Track:0, id=1, mimeType=video/x-vnd.on2.vp9, res=1920x1080, language=und, selectionFlags=[default], supported=YES
D/EventLogger:   ]
D/EventLogger:   group [
D/EventLogger:     [X] Track:0, id=2, mimeType=audio/opus, channels=2, sample_rate=48000, language=en, selectionFlags=[default], supported=YES
D/EventLogger:   ]
D/EventLogger: ]
I/DMCodecAdapterFactory: Creating an asynchronous MediaCodec adapter for track type video
D/EventLogger: downstreamFormat [eventTime=0.33, mediaPos=0.00, window=0, period=0, id=1, mimeType=video/x-vnd.on2.vp9, res=1920x1080, language=und, selectionFlags=[default]]
D/CCodec: allocate(c2.qti.vp9.decoder)
I/CCodec: setting up 'default' as default (vendor) store
I/CCodec: Created component [c2.qti.vp9.decoder]
D/CCodecConfig: read media type: video/x-vnd.on2.vp9
```

Exoplayer Version:  2.18.3
Devices: All


Thanks!
   

    
","['enhancement', 'low priority']",['icbaker'],,3
11038,"When Android TV play video with rotation metadata, some time get wrong stream decode rotation.",open,2023-03-06 07:58:06,2023-04-07 02:17:34,,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Adnrdoi studio ide build-in Emulator:
- Android TV (1080p) API 30 x86
- Android TV (1080p) API 30 x86 - AOSP version

Real Device
- Sony BRAVIA device build-in Android 10
  - Sometime may not reproduce. Click quicker when app start is easier to reproduce.


### Devices that do not reproduce the issue

Chromecast with Google TV

### Reproducible in the demo app?

No

### Reproduction steps

1. Open the app witch I provide.
2. Click buttons and check those videos. Check the playback rotation correct.

### Expected result

Those videos's rotation correct.

### Actual result

The track was squeezed on those devices.

### Media

I will submit the video files, the app and demo beheavior via e-mail.

===================================================
I am not sure witch column to fill the additional disgustion/symptoms , so I leave here.

It may reproduce on Sony BRAVIA itself app call ""Media Player"" or VLC app.
If the video track contain rotation metadata, it may play wrong direction.
I also tried the [media3](https://developer.android.com/jetpack/androidx/releases/media3) `androidx.media3:media3-exoplayer:1.0.0-rc01`, it get the same result.
Witch i guess it probably relate to hardware decode timing issue? 



### Bug Report

- [x] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.
  - submited with related videos.
  - The videos with rotation metadata are on source code dir `app\src\main\res\raw`, I forgot attach additional.","['bug', 'needs triage']",['christosts'],,6
11037,"Dynamic changes to playlist, removing items",closed,2023-03-05 19:24:25,2023-05-08 01:05:23,2023-03-08 10:05:52,"Hi. I can not find uptodate information wheather exoplayer supports dynamic changes to playlist. 
For example I need to remove items. 
I set exoplayer with concatenating mediasource, and I only find .removeMediaItem(index) method. It throws IllegalArgumentException when I call it while exoplayer is playing. 
So is there a way to do this? ","['question', 'needs triage']",['christosts'],,3
11036,Get current manifest from the player,closed,2023-03-04 09:28:39,2023-05-04 01:05:33,2023-03-04 14:14:18,"I am looking for some additional network logs which can give me the current manifest as string 
```
private val exoListener = object : Player.Listener {
        override fun onTimelineChanged(timeline: Timeline, reason: Int) {
            super.onTimelineChanged(timeline, reason)        
            if (exoPlayer != null && exoPlayer!!.playWhenReady) {
                val manifest: Any? = exoPlayer!!.currentManifest
                if (manifest != null) {
                    if (manifest is HlsManifest) 
                       readHLSManifest(manifest)
                }
            }
        }
    }
```

How can I get this manifest in string format? Or is there any other method to do it?",['question'],['marcbaechinger'],,1
11035,"when using Clipping Configuration, the last few seconds of the fragment are cut off",closed,2023-03-03 21:26:33,2023-06-01 01:05:27,2023-03-24 06:20:04,"I have a large audio file, I use Clipping Configuring to divide it into parts (one part ends and a new fragment starts from the same position).  With this performance, several seconds sometimes disappear between fragments.  This happens with different files and with different fragments.","['question', 'need more info', 'stale']",['christosts'],,2
11034,r2.18.4,closed,2023-03-02 18:06:37,2023-05-03 01:05:32,2023-03-03 10:01:46,,[],[],,1
11033,When I use the ExoPlyer2.10.0 version 4k mp4 some error happened,closed,2023-03-02 10:45:48,2023-05-04 01:05:33,2023-03-04 14:03:14,"When I use the ExoPlyer2.10.0 version 4k mp4 video, the following error occurs and the playback fails. The referenced ExoPlayer version cannot be upgraded for some reason. Is there any way to solve this problem.

```
decoderInitialized [0.94, 0.00, window=0, period=0, video, OMX.rk.video_decoder.avc]
decoderInputFormatChanged [0.94, 0.00, window=0, period=0, video, id=1, mimeType=video/avc, res=3840x2160, fps=29.970058]
downstreamFormatChanged [0.95, 0.00, window=0, period=0, id=2, mimeType=audio/mp4a-latm, channels=2, sample_rate=44100, language=```]
Internal runtime error.
java.lang.IllegalStateException: Buffer too small (4177920 < 5601850)
	at com.google.android.exoplayer2.decoder.DecoderInputBuffer.createReplacementByteBuffer(DecoderInputBuffer.java:167)
	at com.google.android.exoplayer2.decoder.DecoderInputBuffer.ensureSpaceForWrite(DecoderInputBuffer.java:117)
	at com.google.android.exoplayer2.source.SampleQueue.read(SampleQueue.java:356)
	at com.google.android.exoplayer2.source.ProgressiveMediaPeriod.readData(ProgressiveMediaPeriod.java:449)
	at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$SampleStreamImpl.readData(ProgressiveMediaPeriod.java:872)
	at com.google.android.exoplayer2.BaseRenderer.readSource(BaseRenderer.java:308)
	at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.feedInputBuffer(MediaCodecRenderer.java:1019)
	at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(MediaCodecRenderer.java:653)
	at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:575)
	at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:326)
	at android.os.Handler.dispatchMessage(Handler.java:102)
	at android.os.Looper.loop(Looper.java:223)
	at android.os.HandlerThread.run(HandlerThread.java:67)
playerFailed [0.99, 0.00, window=0, period=0]
com.google.android.exoplayer2.ExoPlaybackException: java.lang.IllegalStateException: Buffer too small (4177920 < 5601850)
	at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:397)
	at android.os.Handler.dispatchMessage(Handler.java:102)
	at android.os.Looper.loop(Looper.java:223)
	at android.os.HandlerThread.run(HandlerThread.java:67)
Caused by: java.lang.IllegalStateException: Buffer too small (4177920 < 5601850)
	at com.google.android.exoplayer2.decoder.DecoderInputBuffer.createReplacementByteBuffer(DecoderInputBuffer.java:167)
	at com.google.android.exoplayer2.decoder.DecoderInputBuffer.ensureSpaceForWrite(DecoderInputBuffer.java:117)
	at com.google.android.exoplayer2.source.SampleQueue.read(SampleQueue.java:356)
	at com.google.android.exoplayer2.source.ProgressiveMediaPeriod.readData(ProgressiveMediaPeriod.java:449)
	at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$SampleStreamImpl.readData(ProgressiveMediaPeriod.java:872)
	at com.google.android.exoplayer2.BaseRenderer.readSource(BaseRenderer.java:308)
	at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.feedInputBuffer(MediaCodecRenderer.java:1019)
	at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(MediaCodecRenderer.java:653)
	at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:575)
	at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:326)
	at android.os.Handler.dispatchMessage(Handler.java:102) 
	at android.os.Looper.loop(Looper.java:223) 
	at android.os.HandlerThread.run(HandlerThread.java:67) 
```","['question', 'needs triage']",[],,0
11032,About macro expansion of tracker URLs when using client-side ad insertion,closed,2023-03-02 10:14:21,2023-05-02 01:05:36,2023-03-02 17:15:15,"Hi! I have a question of MACRO expansion of Exo Player IMA extension.

I want to fire imp tracker of VAST response by replacing some parts of them.
For example, If the below VAST response is given,

```xml
<vmap:VMAP
		xmlns:vmap=""http://www.iab.net/videosuite/vmap"" version=""1.0"">
	<vmap:AdBreak timeOffset=""#1"" breakType=""linear"">
		<vmap:AdSource>
			<vmap:VASTAdData>
				<VAST version=""3.0"">
					<Ad sequence=""1"">
						<InLine>
							<AdSystem version=""1"">
								<![CDATA[...]]>
							</AdSystem>
							<AdTitle>
								<![CDATA[...]]>
							</AdTitle>
							<Impression id=""Moloco"">
								<![CDATA[https://dummy.com/imp?imp_id=abc123&user_id=%%USER_ID%%]]>
							</Impression>
							<Creatives>
								<Creative id=""aaaaaD7TvvyX5ZtkIz4eG.j.Uz0Kglh3U7sDROzm"" sequence=""1"">
									<Linear>
										<Duration>00:00:30</Duration>
										<TrackingEvents>
											<Tracking id=""Moloco_4q"" event=""complete"">
												<![CDATA[ https://dummy.com/imp?imp_id=abc123&user_id=%%USER_ID%%&event-complete ]]>
											</Tracking>
										</TrackingEvents>
										<VideoClicks></VideoClicks>
										<MediaFiles>
											<MediaFile id=""mediafile"" delivery=""progressive"" type=""video/mp4"" bitrate=""700"" width=""1920"" height=""1080"">
												<![CDATA[......]]>
											</MediaFile>

										</MediaFiles>
									</Linear>
									<CreativeExtensions></CreativeExtensions>
								</Creative>
							</Creatives>
							<Description></Description>
							<Survey></Survey>
							<Extensions></Extensions>
						</InLine>
					</Ad>
				</VAST>
			</vmap:VASTAdData>
		</vmap:AdSource>
	</vmap:AdBreak>
</vmap:VMAP>
```

we want to replace `%%USER_ID%%` to actual user id. 
- .../imp?imp_id=abc123&user_id=`%%USER_ID%%` -> .../imp?imp_id=abc123&user_id=`userid123`

Could you guide me on how to replace the macro with our custom value?
I will use Client-side Ad Insertion which described at https://exoplayer.dev/ad-insertion.html

",['question'],['marcbaechinger'],,10
11031,"Custom MediaSources, resolving MediaItems from remote API, and metadata updates",closed,2023-03-02 00:41:07,2023-05-02 01:05:37,2023-03-02 09:20:12,"I've searched around extensively on this repository, on the `androidx/media` repository, on stack overflow, and I've been browsing through the source to determine the best course of action for my use case but I haven't really found much, and I've run into issues or gaps in the explanation on the information I have found.

The use case I have seems like it calls for custom media sources, for the most part it isn't complex, it's a case of loading the media based upon an internal URI system. But there are some additional complexities when it comes to the type of media to load.

Key details:
- I'm using ExoPlayer via Media3
- I am aiming to treat Media3 (and the underlying ExoPlayer) as my single source of truth for playback, i.e. all information shown in the player UI and media notification should come from Media3/ExoPlayer. (With the notification being automatic in media3).
- The content I am loading comes from a remote datastore API, I am aiming to encapsulate this within the Media3/ExoPlayer part of my app. In other words, As far as my app UI is concerned, it just needs to add a MediaItem that uses request metadata to point to one of my internal URIs (something like `mydatastorescheme://podcast/{id}`) and the rest is handled opaquely inside the Media code.
- I have many different types of content to load, all audio, but things like podcasts, audio books, live radio, etc.

In Media3 there is the `MediaSession` callback with the required `onAddMediaItems` function. This function works fine for loading the correct audio URLs and metadata for a particular bit of content referenced by one of my internal URIs. e.g. I can take the request metadata, lookup in my system what `mydatastorescheme://podcast/1234` is, get its title, description, presenter name, audio stream URL, etc and I can fill out a `MediaItem` with that information.

However this approach seems somewhat naive and could balloon out a bit when it comes to supporting a wide variety of content types as simple as it is initially. I encountered a roadblock here when it comes to live radio streams, as the `MediaItem` is immutable and I have a need to hit another part of my API at scheduled times in order to update certain parts about the metadata (i.e. what radio program is currently airing, who is presenting, etc). This lead me down the path of looking more at the integration with ExoPlayer and creating custom media sources.

I've been attempting to set this up for the last few days with limited success and with some uncertainty over whether I'm using things in the right way.

The first problem I'm tackling is loading simple, on demand content with unchanging metadata (like the podcast example above). I've looked at both `MediaSource` factories and `DataSource` factories for achieving this (particularly the `ResolvingDataSource`). There's a few different roadblocks I've run into with trying each of these approaches:

- Using the `DefaultMediaSourceFactory` with a `ResolvingDataSource` doesn't work to resolve my content before creating a media source as the media sources are created before the data source is used, the `DefaultMediaSourceFactory` also aborts if the local configuration of the `MediaItem` is null, which it is for me at this stage since the `RequestMetadata` still needs to be resolved.
- It would be wrong to simply put my internal URL from the `RequestMetadata` into the local configuration, as the type of the media is still unknown at this point, so the `DefaultMediaSourceFactory` wouldn't be able to correctly select the right `MediaSource` and would just fall through to the default `ProgressiveMediaSource`.
- Using a `CompositeMediaSource` I am able to set up a loader to resolve my internal URI to an actual `MediaItem` with local configuration and metadata, I can then pass this to `DefaultMediaSourceFactory` to get a `MediaSource` which I can prepare as a child of my `CompositeMediaSource`. However, I'm not certain if this is an ideal approach (using a media source factory inside another media source), I've seen a question asked about this without really getting an answer on it specifically (here: https://github.com/androidx/media/issues/17)
- Using the `CompositeMediaSource` approach I can get the audio content playing but the metadata doesn't seem to update. From tracing through the code execution it seems like the block that builds new metadata from incoming playback info (in `ExoPlayer::updatePlaybackInfo`) isn't getting run due to either `mediaItemTransitioned` being false or the `staticMetadata` being the same across the previous and new playback info objects. My setup is very similar to that seen in the above linked question. In `onChildSourceInfoRefreshed` I'm simply calling `refreshSourceInfo` with the new timeline as seen in some built-in composite media sources like `WrappingMediaSource`. I'm unsure why this doesn't carry through and update the metadata in the player.

If I can get that working then the next step would be working out what's required (likely in another custom `MediaSource`) to load a stream for playback, then call an API at specific times to fetch the metadata for the next airing program (API has the current and next available with timestamps for the start and end times of each). This feels like it's a job for periods on a timeline? But the mechanism through which to make those schedules API calls and surface the metadata is still unclear to me.

The documentation doesn't really have much info in it for worked examples on customized Media Sources, and resolving media lazily from an internal API seems to be a common-ish question just with different nuances. I read through another example of this here: https://github.com/google/ExoPlayer/issues/5883 though it still leaves some questions unanswered (such as my questions above on the use of a factory inside a media source, or the issue with metadata now flowing through from the added child source to the player.

If I could get some guidance on these questions or if this is completely the wrong direction some guidance of what the right direction is, then that would be much appreciated.
",['question'],['icbaker'],,4
11030,Subtitles don't work inside segment of m3u8,closed,2023-03-01 20:01:25,2023-05-13 01:04:57,2023-03-13 16:51:05,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Pixel 6 pro and Chromecast with Google TV

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Opened the demo project and added to `demos/main/src/main/assets/media.exolist.json` the json below:
```
{
    ""name"": ""My tests"",
    ""samples"": [
      {
        ""name"": ""Caption 1"",
        ""uri"": ""https://bcovlive-a.akamaihd.net/c9bf201b06694453bb29282f97191f58/us-east-1/6240731308001/playlist.m3u8""
      },
      {
        ""name"": ""Caption 2"",
        ""uri"": ""https://bcovlive-a.akamaihd.net/c9bf201b06694453bb29282f97191f58/us-east-1/6240731308001/profile_0/chunklist.m3u8""
      }
    ]
  }
```

When I run the demo, it doesn't show any subtitles for the video titles `Caption 1` but it does for `Caption 2` even though 2 is just one of the variants of the master list 1. 

### Expected result

It should show a subtitle track. 

### Actual result

No subtitles shown. 

### Media

https://bcovlive-a.akamaihd.net/c9bf201b06694453bb29282f97191f58/us-east-1/6240731308001/playlist.m3u8

Whereas this specific variant works https://bcovlive-a.akamaihd.net/c9bf201b06694453bb29282f97191f58/us-east-1/6240731308001/profile_0/chunklist.m3u8


### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['question'],['tianyif'],,4
11029,"Does ExoPlayer support Vr playback, gyroscope, dual-screen mode ？",closed,2023-03-01 08:56:02,2023-06-01 01:05:28,2023-03-29 01:06:45,"Before filing a feature request:
-----------------------
- Search existing open issues, specifically with the label ‘enhancement’:
  https://github.com/google/ExoPlayer/labels/enhancement
- Search existing pull requests: https://github.com/google/ExoPlayer/pulls

When filing a feature request:
-----------------------
Replace the content in the sections below.

### [REQUIRED] Use case description
Describe the use case or problem you are trying to solve in detail. If there are
any standards or specifications involved, please provide the relevant details.

### Proposed solution
A clear and concise description of your proposed solution, if you have one.

### Alternatives considered
A clear and concise description of any alternative solutions you considered,
if applicable.
","['question', 'closed-by-bot']",['andrewlewis'],,3
11028,MediaCodecRenderer: Errors categorisation if fallback codec applied,closed,2023-02-28 11:25:00,2023-05-07 01:05:04,2023-03-07 08:15:29,"Hi. At first thank you for all your efforts in developing `ExoPlayer`!

**Problem**
Sometimes main media codes isn't available, which triggers `ERROR_CODE_DECODER_INIT_FAILED`.
As a solution, it's possible to enable a fallback for `rendersFactory`:
```
renderersFactory.setEnableDecoderFallback(true)
```

Which according to logic in [MediaCoderRenderer](https://github.com/google/ExoPlayer/blob/f72ca8338399c9e3c19e73fc0779f24baff14d35/library/core/src/main/java/com/google/android/exoplayer2/mediacodec/MediaCodecRenderer.java#L981) adds all available mediacodes.
However, it looks like that we always throw the same error (with different codec details) if fallback codec isn't available in addition to main codec, which make it difficult to categorise errors in analytics (`onVideoCodecError`)

*Step 1*: Trying to initialise decoder
*Step 2*: Failed. Reported `ERROR_CODE_DECODER_INIT_FAILED`
*Step 3*: Trying to initialise fallback decoder
*Step 4*: Failed. Reported `ERROR_CODE_DECODER_INIT_FAILED` 

So, we understand that a fallback applied, however in analytics it will be 2 the same errors.
________

**Proposed behaviour**
It would be great to understand that it isn't possible to playback video via fallback codec, for instance, like this:

*Step 1*: Trying to initialise decoder
*Step 2*: Failed. Reported `ERROR_CODE_DECODER_INIT_FAILED`
*Step 3*: Trying to initialise fallback decoder
*Step 4*: Failed. Reported `ERROR_CODE_FALLBACK_DECODER_INIT_FAILED` 


**Question**
What do you think about this? Maybe I missed something and there some other ways to categorise coder initialisation errors?

Thank you in advance.",['question'],['christosts'],,5
11027,How to keep the same order of custom media actions ,open,2023-02-28 06:41:26,2023-06-09 17:08:43,,"I want to use custom next/previous actions instead of the native ones. So I started by removing the native ones by allowing only needed actions: But in some devices 
 ```
MediaSessionConnector(mediaSession).setCustomActionProviders(object :
                MediaSessionConnector.CustomActionProvider {
                override fun onCustomAction(player: Player, action: String, extras: Bundle?) {}

                override fun getCustomAction(player: Player): PlaybackStateCompat.CustomAction? {
                    return PlaybackStateCompat.CustomAction.Builder(
                        ""SKIP_TO_PREVIOUS_ACTION"",
                        ""previous"",
                        if (!isFirst)
                            R.drawable.ic_previous_with_padding
                        else R.drawable.ic_previous_disabled_with_padding
                    ).build()
                }
            },
        object : MediaSessionConnector.CustomActionProvider {
                override fun onCustomAction(player: Player, action: String, extras: Bundle?) {}

                override fun getCustomAction(player: Player): PlaybackStateCompat.CustomAction? {
                    return PlaybackStateCompat.CustomAction.Builder(
                        ""SKIP_TO_NEXT_ACTION"",
                        ""next"",
                        if (!isLast)
                            R.drawable.ic_next_with_padding
                        else R.drawable.ic_next_disabled_with_padding
                    ).build()
                }
            }

```
![1](https://user-images.githubusercontent.com/126549215/221774016-d56321a2-bafb-4127-b265-61eaf8f8b3f3.png)
![2](https://user-images.githubusercontent.com/126549215/221774025-93604e03-d082-4a0b-a6bf-7711801359bf.png)



As you observed, the buttons in the home section  are inverted, how can I keep the same order as in the app? But in some devices its working fine 
Any idea how we can resolve this?
@phhusson @xian @canatella @kiall @talklittle  @marcbaechinger 
",['question'],['marcbaechinger'],,10
11026,R2.18.3 beta01,closed,2023-02-28 04:25:06,2023-04-30 01:04:57,2023-02-28 04:25:33,,[],[],,1
11025,URL redirect in HLS stream breaks MediaSource/MimeType recognition,closed,2023-02-27 12:52:57,2023-06-04 01:05:06,2023-04-04 08:46:36,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

All

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Use this URL that redirects to a HLS stream: https://m3u-ip.tv/test-redirect.php

Simple example code:
```
DefaultRenderersFactory renderersFactory =
	new DefaultRenderersFactory(this).forceEnableMediaCodecAsynchronousQueueing();

// Build a HttpDataSource.Factory with cross-protocol redirects enabled.
HttpDataSource.Factory httpDataSourceFactory =
	new DefaultHttpDataSource.Factory().setAllowCrossProtocolRedirects(true);
DefaultDataSource.Factory dataSourceFactory =
	new DefaultDataSource.Factory(this, httpDataSourceFactory);

ExoPlayer oPlayer = new ExoPlayer.Builder(this, renderersFactory)
	.setMediaSourceFactory(new DefaultMediaSourceFactory(dataSourceFactory))
	.build();

MediaItem mediaItem = new MediaItem.Builder()
	.setUri(""https://m3u-ip.tv/test-redirect.php"")
 // .setMimeType(MimeTypes.APPLICATION_M3U8) // works with that, but other stream types won't work anymore
	.build();

oPlayer.setMediaItem(mediaItem);
oPlayer.prepare();
oPlayer.play();
```

### Expected result

Redirect is done, MediaSource/MimeType is recognized as a HLS stream (HlsMediaSource) and stream is playing.

### Actual result

Stream is not playing. Looks like stream is recognized as ProgressiveMediaSource... Error:
Caused by: com.google.android.exoplayer2.source.UnrecognizedInputFormatException: None of the available extractors (FlvExtractor, FlacExtractor, WavExtractor, FragmentedMp4Extractor, Mp4Extractor, AmrExtractor, PsExtractor, OggExtractor, TsExtractor, MatroskaExtractor, AdtsExtractor, Ac3Extractor, Ac4Extractor, Mp3Extractor, AviExtractor, JpegExtractor) could read the stream.
  at com.google.android.exoplayer2.source.BundledExtractorsAdapter.init(BundledExtractorsAdapter.java:92)
  at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$ExtractingLoadable.load(ProgressiveMediaPeriod.java:1017)
  at com.google.android.exoplayer2.upstream.Loader$LoadTask.run(Loader.java:412)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)
  at java.lang.Thread.run(Thread.java:919)

Note: If URL has no redirect, the stream plays. Also if ...setMimeType(MimeTypes.APPLICATION_M3U8) is used, the stream is played after redirect.

### Media

Use this URL: https://m3u-ip.tv/test-redirect.php
It redirects to a German public channel.

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['question'],['tonihei'],,3
11024,Resuming progressive stream after reconnect,closed,2023-02-27 10:59:50,2023-06-04 01:05:06,2023-04-04 08:34:09,"So I have a situation with a progressive stream (mpeg-ts) that can be seeked in by range request. This means I can customize a SeekMap to translate timestamps to byte positions and it all works very well.

The issue appears when the stream reconnects (for verious reasons) and I cannot figure out how to best resume the stream from where it left of.
I see that SeekMap's _getSeekPoints()_ are invoked but the timestamp is always 0. Tracing this method up in the stack I see that 
_ProgressiveMediaPeriod_'s _continueLoading()_ does not use _playbackPositionUs_ argument. A simple test by assigning _pendingResetPositionUs_ to this argument would also solve my issue.
My second thought would be to check _onPlayerError()_ for this error and do the seeking on my own, but this is never invoked.

So my questions are, why isn't _playbackPositionUs_ used, there must be a reason for it? And secondly, how can I solve this otherwise?",['question'],['tonihei'],,9
11023,Exoplayer version 2.18.3 got error mix androidx and old support,closed,2023-02-27 09:15:58,2023-04-30 01:04:58,2023-02-28 09:51:19,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Hi when i do complaining i got this error : exoplayer-ui-2.18.3.aar' contains references to both AndroidX and old support library. This seems like the library is partially migrated. Jetifier will try to rewrite the library anyway.

How to fix it?

### Devices that do not reproduce the issue

Android tv emulator

### Reproducible in the demo app?

Yes

### Reproduction steps

install with latest version then do run install. You will see error in the log gradlew install.

### Expected result

-The error should be remove like in 2.18.2 no problem

### Actual result

Error come like about.

### Media

You can see the error log give above for you reference

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['duplicate'],['christosts'],,2
11022,How to custom ExoPlayer to handle Partial Content 206?,closed,2023-02-26 08:36:03,2023-06-01 01:05:28,2023-03-28 01:06:23,"I know this is not supposed to be the correct way to consume stream.
The content length should be determined by ExoPlayer and the server is about to stream the whole file.
But, I don't trust my client to handle to the stream efficiently and not to abuse.
Is there a way that I can custom ExoPlayer to handle the `Range` header correctly?","['question', 'closed-by-bot']",['christosts'],,11
11021,CastPlayer - java.lang.IllegalArgumentException,closed,2023-02-25 13:10:21,2023-04-29 01:04:54,2023-02-27 15:41:53,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

OnePlus 7 running Android 11

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Run cast demo.
Connect to the device with the cast capability (Tv, Speaker, reproduced on both)

### Expected result

The Cast session is started succesfuly 

### Actual result

```
java.lang.IllegalArgumentException: The given region must intersect with the Bitmap's dimensions.
  at androidx.palette.graphics.Palette$Builder.setRegion(Palette.java:733)
  at com.android.systemui.statusbar.notification.MediaNotificationProcessor.generateArtworkPaletteBuilder(MediaNotificationProcessor.java:332)
  at com.android.systemui.media.MediaDataManager.computeBackgroundColor(MediaDataManager.kt:475)
  at com.android.systemui.media.MediaDataManager.loadMediaDataInBg(MediaDataManager.kt:356)
   at com.android.systemui.media.MediaDataManager.access$loadMediaDataInBg(MediaDataManager.kt:89)
   at com.android.systemui.media.MediaDataManager$loadMediaData$1.run(MediaDataManager.kt:241)
   at android.os.Handler.handleCallback(Handler.java:938)
   at android.os.Handler.dispatchMessage(Handler.java:99)
   at android.os.Looper.loop(Looper.java:233)
   at android.os.HandlerThread.run(HandlerThread.java:67)
```

### Media

The issues is reproducible in the Exo Cast Demo application. 

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug: in dependency'],['marcbaechinger'],,7
11020,Custom DataSourceFactory with Firebase auth idToken,closed,2023-02-25 04:00:43,2023-04-28 01:05:42,2023-02-26 07:23:47,"How do I create a custom `DataSource.Factory` where it can run suspend code?

```kt
val defaultDataSourceFactory = DefaultHttpDataSource.Factory()
val dataSourceFactory = DataSource.Factory {
    val dataSource = defaultDataSourceFactory.createDataSource()
    val idToken = FirebaseAuth.getInstance().currentUser!!.getIdToken(false) // <- Here return a Task not a String
    dataSource.setRequestProperty(""Authorization"", ""<supposed id token>"")
    dataSource
}
val player = ExoPlayer
    .Builder(this)
    .setMediaSourceFactory(DefaultMediaSourceFactory(dataSourceFactory))
    .build()
```","['question', 'needs triage']",[],,1
11019,Cut Closed captions (C608) when html tag mixed with normal text,closed,2023-02-24 16:25:10,2023-08-30 01:05:05,2023-06-30 16:37:49,"### ExoPlayer Version

2.17.1

### Devices that reproduce the issue

All devices 
I've tested at Samsung Galaxy A10 but our client report it at multiple devices

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

It's reproducible at demo device but required is special content.
IMHO when measure space need to draw Closed captions 608, in case there is html mixed content 
eg.

>    The USS<i> Cerritos</i> remains in  
Spacedock, impounded for further
         investigation. 

Also this is a regression introduced between r2.11.8  => r2.12.3 and can be reproduced on newest version


### Expected result

Issue were not observed eg. at Exoplayer r2.11.8

### Actual result

Space for draw Closed captions is cut, and such subtitles are not displayed properly
Exoplayer 2.11.8

![Exoplayer2 11 8](https://user-images.githubusercontent.com/47888710/221231183-2ded5371-4e4e-43b6-9544-a73439515709.png)

Exoplayer 2.12.3

![Exoplayer2 12 3](https://user-images.githubusercontent.com/47888710/221231192-669c4b9f-210a-4e4d-bdb3-292bce3e7985.png)

Exoplayer 2.18.2

![Exoplayer2 18 2](https://user-images.githubusercontent.com/47888710/221231200-3f73889e-f706-4c47-81ad-6ad8f66412d1.png)

Exoplayer 2.7.3
![Exoplayer 2 7 3](https://user-images.githubusercontent.com/47888710/221231204-13dd5367-ff9e-499a-a039-911645b370a6.png)


### Media


I'm trying to get publicly accessed content but currently I'm waiting for it.

IMHO to reproduce issue there is need content with embed closed caption where html tagged eg. by Italic text fragment is mixed with normal text

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug'],['icbaker'],,10
11018,Not able to cast some of client provided m3u8 (Version 5) video URL,closed,2023-02-24 13:57:28,2023-05-10 01:05:33,2023-03-10 13:41:25,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

All Android Device.

### Devices that do not reproduce the issue

All Supported Version

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Try adding below url in sample app and try to cast on Android TV / chromcast device.

 new MediaItem.Builder()
         .setUri(""https://content.uplynk.com/ext/fc1d615459a64336b5ccdc137ffeddc6/01GK5YWXVFSQMNQ30ASXB6XNEG.m3u8"")
            .setMediaMetadata(new MediaMetadata.Builder().setTitle(""Canela URL"").build())
            .setMimeType(MIME_TYPE_HLS)
            .build());

### Expected result

Video should be cast on the TV successfully.

### Actual result

Video is not playing on the TV.

### Media

URL - https://content.uplynk.com/ext/fc1d615459a64336b5ccdc137ffeddc6/01GK5YWXVFSQMNQ30ASXB6XNEG.m3u8

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug: device specific'],['marcbaechinger'],,4
11017,Use edts media time offset if edits list duration is entire media duration.,closed,2023-02-24 11:52:17,2023-04-29 01:04:54,2023-02-27 09:22:32,,[],[],,0
11016,Regarding removing the Notification from Notification bar,open,2023-02-24 09:40:18,2023-02-26 19:14:17,,"Hi Team,

I need to show one notification while User is locking the device. I am using PlayerNotificationManager and MediaSessionConnector for showing the notification and setting the controls like seekbar, play/pause. Everything is working fine. I need to remove the notification from the notificationbar when User is coming back from that fragment as I don't want to display it to user anymore.

I have tried to cancel the Notification with following ways:
notificationManager.setPlayer(null)
cancel (Notification_id) 

Nothing seems to work, can you please suggest something?

Regards,
Rohit Garg",['question'],['marcbaechinger'],,2
11015,Video 4096 *2160 is not Playing.,open,2023-02-24 04:56:16,2023-08-05 10:44:42,,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Android 8.1 vivo 1811
Android 11
Android 7.1.2 redmi  Y1

### Devices that do not reproduce the issue

Redmi 9 11 RP1A200720.011 MIUI Global 12.5.6


### Reproducible in the demo app?

Yes

### Reproduction steps


--------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------
Code:

   public void initilisePlayer()
    {
        DefaultRenderersFactory rf = new DefaultRenderersFactory(MainActivity.this)
                .setExtensionRendererMode(EXTENSION_RENDERER_MODE_PREFER).setMediaCodecSelector(
                        new MediaCodecSelector() {
                            @Override
                            public List<MediaCodecInfo> getDecoderInfos(String mimeType,
                                                                        boolean requiresSecureDecoder, boolean requiresTunnelingDecoder)
                                    throws MediaCodecUtil.DecoderQueryException {
                                List<MediaCodecInfo> decoderInfos = MediaCodecSelector.DEFAULT
                                        .getDecoderInfos(mimeType, requiresSecureDecoder, requiresTunnelingDecoder);
                                if (MimeTypes.VIDEO_H264.equals(mimeType)) {
                                    // copy the list because MediaCodecSelector.DEFAULT returns an unmodifiable list
                                    decoderInfos = new ArrayList<>(decoderInfos);
                                    Collections.reverse(decoderInfos);
                                }
                                return decoderInfos;
                            }
                        });

        // url of video which we are loading.
//      
       
     
        //sorry i can not share url.
//     



        DefaultLoadControl loadControl = new DefaultLoadControl
                .Builder()
                .setBufferDurationsMs(32*1024, 64*1024, 1024, 1024)
                .createDefaultLoadControl();

//        DataSource.Factory cacheDataSourceFactory =
//                new CacheDataSource.Factory()
//                        .setCache(com.axat.starbarn.model.SimpleMediaPlayer.getInstance(MainActivity.this))
//                        .setUpstreamDataSourceFactory(new DefaultHttpDataSource.Factory()
//                                .setUserAgent(MainActivity.this.getString(R.string.app_name)));



        exoPlayer = new ExoPlayer.Builder(MainActivity.this,rf).setLoadControl(loadControl).build();

//

        exoPlayer.addListener(new Player.Listener() {
            @Override
            public void onPlayerStateChanged(boolean playWhenReady, int playbackState) {
                Player.Listener.super.onPlayerStateChanged(playWhenReady, playbackState);


            }

            @Override
            public void onMediaMetadataChanged(MediaMetadata mediaMetadata) {
                Player.Listener.super.onMediaMetadataChanged(mediaMetadata);
            }

            @Override
            public void onPlayerError(PlaybackException error) {
                Player.Listener.super.onPlayerError(error);
                Log.e(""play_error"",""""+error.getMessage().toString()+""""+error.errorCode);
//                    Toast.makeText(context, ""Can't play this video"", Toast.LENGTH_SHORT).show();
            }
        });



//
        exoPlayerView.setResizeMode(AspectRatioFrameLayout.RESIZE_MODE_ZOOM);
        exoPlayerView.setShutterBackgroundColor(Color.TRANSPARENT);
        exoPlayerView.setKeepContentOnPlayerReset(true);
        exoPlayer.seekTo(0);
        exoPlayer.setRepeatMode(Player.REPEAT_MODE_ONE);




        MediaSource mediaSource = new ProgressiveMediaSource.Factory(
                new CacheDataSource.Factory()
                        .setCache(com.axat.starbarn.model.SimpleMediaPlayer.getInstance(MainActivity.this))
                        .setUpstreamDataSourceFactory(new DefaultHttpDataSource.Factory()
                                .setUserAgent(MainActivity.this.getString(R.string.app_name)))
                        .setFlags(CacheDataSource.FLAG_IGNORE_CACHE_ON_ERROR)
        ).createMediaSource(MediaItem.fromUri(videoURL));


        exoPlayer.setMediaSource(mediaSource,true);
        exoPlayerView.setPlayer(exoPlayer);
        exoPlayer.setPlayWhenReady(true);
        exoPlayer.prepare();
        exoPlayer.play();
    }


--------------
 private void releasePlayer() {
        exoPlayer.setPlayWhenReady(false);
        exoPlayer.stop();

        exoPlayer.release();
        exoPlayerView.clearAnimation();
        exoPlayerView.getPlayer().clearVideoSurface();
        exoPlayer=null;
        exoPlayerView.setPlayer(null);
    }
--------------------
 @Override
    protected void onResume() {
//        if (Build.VERSION.SDK_INT <= 23 || exoPlayer == null) {
//
//            Log.e(""method"",""resume"");
//
//            initilisePlayer();
//            if (exoPlayerView != null) {
//                exoPlayerView.onResume();
//            }
//        }
        initilisePlayer();
        super.onResume();
    }

    @Override
    protected void onPause() {

//        if (Build.VERSION.SDK_INT <= 23) {
//            Log.e(""method"",""pause"");
//            if (exoPlayerView != null) {
//                exoPlayerView.onPause();
//            }
//
//        }
        releasePlayer();
        super.onPause();
    }



### Expected result

Video play on all devices.

### Actual result

```
E/MediaCodecVideoRenderer: Video codec error
      java.lang.IllegalStateException
        at android.media.MediaCodec.native_dequeueOutputBuffer(Native Method)
        at android.media.MediaCodec.dequeueOutputBuffer(MediaCodec.java:2632)
        at com.google.android.exoplayer2.mediacodec.SynchronousMediaCodecAdapter.dequeueOutputBufferIndex(SynchronousMediaCodecAdapter.java:106)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.drainOutputBuffer(MediaCodecRenderer.java:1838)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(MediaCodecRenderer.java:792)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:1001)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:502)
        at android.os.Handler.dispatchMessage(Handler.java:102)
        at android.os.Looper.loop(Looper.java:192)
        at android.os.HandlerThread.run(HandlerThread.java:65)
E/pos: 2
D/MediaCodecInfo: NoSupport [sizeAndRate.support, 4096x2160@25.0] [OMX.google.h264.decoder, video/avc] [1811, vivo 1811, vivo, 27]
D/MediaCodecInfo: NoSupport [codec.profileLevel, avc1.640033, video/avc] [OMX.qcom.video.decoder.avc, video/avc] [1811, vivo 1811, vivo, 27]
E/ExoPlayerImplInternal: Playback error
      com.google.android.exoplayer2.ExoPlaybackException: MediaCodecVideoRenderer error, index=0, format=Format(1, null, null, video/avc, avc1.640033, -1, null, [4096, 2160, 25.0], [-1, -1]), format_supported=NO_EXCEEDS_CAPABILITIES
        at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:578)
        at android.os.Handler.dispatchMessage(Handler.java:102)
        at android.os.Looper.loop(Looper.java:192)
        at android.os.HandlerThread.run(HandlerThread.java:65)
     Caused by: com.google.android.exoplayer2.video.MediaCodecVideoDecoderException: Decoder failed: OMX.google.h264.decoder
        at com.google.android.exoplayer2.video.MediaCodecVideoRenderer.createDecoderException(MediaCodecVideoRenderer.java:1629)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(MediaCodecRenderer.java:813)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:1001)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:502)
        at android.os.Handler.dispatchMessage(Handler.java:102) 
        at android.os.Looper.loop(Looper.java:192) 
        at android.os.HandlerThread.run(HandlerThread.java:65) 
     Caused by: java.lang.IllegalStateException
        at android.media.MediaCodec.native_dequeueOutputBuffer(Native Method)
        at android.media.MediaCodec.dequeueOutputBuffer(MediaCodec.java:2632)
        at com.google.android.exoplayer2.mediacodec.SynchronousMediaCodecAdapter.dequeueOutputBufferIndex(SynchronousMediaCodecAdapter.java:106)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.drainOutputBuffer(MediaCodecRenderer.java:1838)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.render(MediaCodecRenderer.java:792)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:1001) 
        at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:502) 
        at android.os.Handler.dispatchMessage(Handler.java:102) 
        at android.os.Looper.loop(Looper.java:192) 
        at android.os.HandlerThread.run(HandlerThread.java:65) 
I/MediaCodec: flush
E/ExoPlayerImplInternal: Disable failed.
      java.lang.IllegalStateException
        at android.media.MediaCodec.native_flush(Native Method)
        at android.media.MediaCodec.flush(MediaCodec.java:2114)
        at com.google.android.exoplayer2.mediacodec.SynchronousMediaCodecAdapter.flush(SynchronousMediaCodecAdapter.java:166)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.flushCodec(MediaCodecRenderer.java:877)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.flushOrReleaseCodec(MediaCodecRenderer.java:870)
        at com.google.android.exoplayer2.mediacodec.MediaCodecRenderer.onDisabled(MediaCodecRenderer.java:710)
        at com.google.android.exoplayer2.video.MediaCodecVideoRenderer.onDisabled(MediaCodecVideoRenderer.java:608)
        at com.google.android.exoplayer2.BaseRenderer.disable(BaseRenderer.java:186)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.disableRenderer(ExoPlayerImplInternal.java:1664)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.resetInternal(ExoPlayerImplInternal.java:1405)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.stopInternal(ExoPlayerImplInternal.java:1366)
        at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:594)
        at android.os.Handler.dispatchMessage(Handler.java:102)
        at android.os.Looper.loop(Looper.java:192)
        at android.os.HandlerThread.run(HandlerThread.java:65)
I/MediaCodec: release
I/MediaCodec: kWhatStop or kWhatRelease
I/ACodec: initiateShutdown kWhatReleaseCodecInstance
E/pos: 2
I/MediaCodec: ~MediaCodec
E/play_error: MediaCodecVideoRenderer error, index=0, format=Format(1, null, null, video/avc, avc1.640033, -1, null, [4096, 2160, 25.0], [-1, -1]), format_supported=NO_EXCEEDS_CAPABILITIES4003
E/pos: 2
```

### Media
https://thegoatappvideos.s3.us-east-2.amazonaws.com/post_video/productio.mp4


### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug: device specific'],['marcbaechinger'],,3
11014,"SegmentBase getSegmentTimeUs does not perform a bounds check, results in out of bounds error",closed,2023-02-24 02:59:54,2023-06-04 01:05:07,2023-04-04 08:33:26,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

* Pixel 6 Pro

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Provide a dash manifest with an empty segmentTimeline, `getSegmentTimeUs` attempts to index into `segmentTimeline` which is empty, resulting in an  out of bounds error.

### Expected result

Something other than an out of bounds error, perhaps an error or warn that the segmentTimeline is empty.

### Actual result

Index out of bounds exception

### Media

This was the mpd in question. May violate DASH spec, but a more useful error would be appreciated
[DASH_EXAMPLE.zip](https://github.com/google/ExoPlayer/files/10820260/DASH_EXAMPLE.zip)


### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug'],['tonihei'],,3
11013,VP9 extension compile bug,closed,2023-02-23 16:38:39,2023-05-08 01:05:24,2023-03-08 13:05:55,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

MacBook Pro 2013

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Build VP9 extension

### Expected result

Compile without errors.

### Actual result

After i use:
```
cd ${VP9_MODULE_PATH}/jni && \
ln -s ""$LIBVPX_PATH"" libvpx && \
./generate_libvpx_android_configs.sh
```

I get this error in the Terminal:
`clang: error: the clang compiler does not support '-march=armv7-a'`

### Media

No media is needed.

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['question'],['christosts'],,7
11012,Bug on entering replaced ads HLS fmp4,open,2023-02-23 15:50:10,2023-04-09 18:14:08,,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

The problem doesn't seem to be device specific. Happens on devices and on emulator.

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Play the included live stream and watch it across a couple of ad breaks.

This stream will have a 2 minute ad break every 5 minutes. (:01, :06, :11, :16 ... :56)

### Expected result

The player should play normally across the ad breaks.

### Actual result

Sometimes the ads will play OK. But it will inevitably end up in a broken state upon entering an ad break sooner or later (usually the second ad break). When this happens, the timeline seems broken. The player will attempt to seek to time that is not part of the current buffer, a time in the future.

Example image:
![image](https://user-images.githubusercontent.com/1465282/220957146-881d3ac8-2457-462b-a37b-d3267d52c604.png)
When the problem happens, the timeline looks like on the left. The player is at position 3:17 when it only has 01:38 worth of content. When in a regular state, it will look like the picture on the right.

### Media

REMOVED

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bad media', 'needs triage']",['marcbaechinger'],,20
11011,Application is crashing if AV1 extension is enabled,open,2023-02-23 13:32:17,2023-03-02 09:37:05,,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

1. Xiaomi Redmi Note 11 Pro+ 5G
2. Google Chromecast 4K
3. Xiaomi Mi Box S

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Build and enable AV1 extension;
2. Set Renderer mode to `DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER`;
3. Watch the video until the end.

### Expected result

Video must stop.

### Actual result

Application is crashing when video ends with `Fatal signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0xa5 in tid 4654 (ExoPlayer:Playb), pid 4195 (my.app)` fatal error.

Only this is available in the log:
```
2023-02-23 15:22:51.565  A  pid: 4195, tid: 4654, name: ExoPlayer:Playb  >>> com.my.app <<<
2023-02-23 15:22:51.565  A        #00 pc 0000000000068848  /data/app/~~6k9XQkBDbYrDWlvm8Hxukg==/com.my.app-IEHIIjZr0KcDf3VXDfJtFw==/lib/arm64/libgav1JNI.so (Java_com_google_android_exoplayer2_ext_av1_Gav1Decoder_gav1ReleaseFrame+100) (BuildId: 4f2560d8317eed9d5043c4136143f7b467bfc4d5)
2023-02-23 15:22:51.565  A        #03 pc 0000000000008092  /data/data/com.my.app/code_cache/.overlay/base.apk/classes4.dex (com.google.android.exoplayer2.ext.av1.Gav1Decoder.releaseOutputBuffer+26)
2023-02-23 15:22:51.565  A        #05 pc 0000000000007d58  /data/data/com.my.app/code_cache/.overlay/base.apk/classes4.dex (com.google.android.exoplayer2.ext.av1.Gav1Decoder$$ExternalSyntheticLambda0.releaseOutputBuffer+8)
2023-02-23 15:22:51.565  A        #07 pc 0000000000019a98  /data/data/com.my.app/code_cache/.overlay/base.apk/classes3.dex (com.google.android.exoplayer2.decoder.VideoDecoderOutputBuffer.release+4)
```

### Media

Media link: https://woolyss.com/f/caminandes-1-llama-drama-av1-opus.webm

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['needs triage'],['christosts'],,4
11010,Use edts media time offset if edits list duration is entire media duration.,closed,2023-02-23 12:43:47,2023-04-26 01:05:46,2023-02-24 11:28:48,"It will fix the AV sync issue mentioned here - https://github.com/google/ExoPlayer/issues/10996 

(Test media file: https://drive.google.com/file/d/156XrRCy0Nxk6_u1fgQa9JVEExy3JeLRk/view?usp=sharing)

",[],[],,7
11009,Events for AudioFocus Loss,closed,2023-02-23 04:09:54,2023-04-25 01:05:46,2023-02-23 17:31:06,"### [REQUIRED] Use case description
I want to report statistics around audio focus loss in my application. It seems I cannot observe the loss without overriding ExoPlayer's handling of audio focus.

I saw https://github.com/google/ExoPlayer/issues/10293 but I do not understand why `onPlaybackSuppressionReasonChanged` exists but does not account for permanent loss of focus.

### Proposed solution
Expose a listener/event to listen to all audio focus events, much like `onPlaybackSuppressionReasonChanged`.

### Alternatives considered
Set `handleAudioFocus` to false and handle in our application. This seems inefficient as ExoPlayer handles the audio focus well.

There is no other way to observe the audio focus to my knowledge.
",['question'],['icbaker'],,2
11008,DefaultDrmSessionManager: null exception fetching crypto type,open,2023-02-22 14:01:40,2023-04-24 17:07:40,,"### ExoPlayer Version

2.18.2

### Devices that reproduce the issue

- Fire TV devices (AFTMM, AFTSSS, AFTSS).
- Chromecast Google TV.
- Samsung Galaxy TAB A7 / Samsung Galaxy S20 / Samsung Galaxy S10+.
- Most common in Android 7, 9 and 5, occurs in all versions but a lot less common.

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

No

### Reproduction steps

Unsure how to reproduce, it's being picked up by our crash reporting system.

### Expected result

Media plays successfully without any issues.

### Actual result

Playback crashes with a null exception;

```stacktrace
Fatal Exception: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.Class java.lang.Object.getClass()' on a null object reference
       at com.google.android.exoplayer2.util.Assertions.checkNotNull(Assertions.java:154)
       at com.google.android.exoplayer2.drm.DefaultDrmSessionManager.getCryptoType(DefaultDrmSessionManager.java:599)
       at com.google.android.exoplayer2.source.dash.DashMediaPeriod.buildPrimaryAndEmbeddedTrackGroupInfos(DashMediaPeriod.java:675)
       at com.google.android.exoplayer2.source.dash.DashMediaPeriod.buildTrackGroups(DashMediaPeriod.java:518)
       at com.google.android.exoplayer2.source.dash.DashMediaPeriod.<init>(DashMediaPeriod.java:153)
       at com.google.android.exoplayer2.source.dash.DashMediaSource.createPeriod(DashMediaSource.java:490)
```

### Media

It's a DASH stream with Widevine encryption, it's not restricted to a single stream though so I'm not sure it's applicable. 

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug'],['icbaker'],,9
11007,Video Enhancement Solution ,closed,2023-02-22 03:28:33,2023-04-24 01:05:38,2023-02-22 11:53:13,"feature request:
-----------------------
There is an urgent need for an integrated solution where the player can perform video enhancement for low-resolution videos to make the video clearer

Use case description
For low-resolution videos, the player can perform video enhancement to make the video clearer
### Proposed solution
A clear and concise description of your proposed solution, if you have one.

### Alternatives considered
Using a trained model, it can be integrated into the exoPlayer player in the form of a plug-in
","['enhancement', 'wont fix: infeasible']",['icbaker'],,1
11006,Playing from cache the first seconds and using adaptive track selection for the rest in a seemless way,closed,2023-02-21 21:10:03,2023-04-25 01:05:47,2023-02-23 11:30:44,"## Context

Hi, I am using ExoPlayer for HLS streaming and I am caching the first two fragment of the HD media playlist (3s per fragment).
At the same time, adaptive track selection is enabled.
What I need is for the player to read the first 6s from cache, and then switch back to adaptive selection in a seemless way.

## What I tried

1. I tried to keep using the player's adaptive selection by setting the same custom cache key for the first 2 fragments of all the media playlists, but I got an Audio discontinuity error (timestamp error). The video works but the sound is off unless I seek a new play position.
 
2. I tried to use a track selection override that I clear after 6 seconds, but if the selected track is different than what was cached, the player will drop what was already buffered for the override and it will start buffering again. So, there's a little pause in that transition.

## Question
Is there a way to achieve playing the first 2 fragments from cache, and then transition back to the adaptive selection in seemless way without loosing what was already buffered?
I know that this works if I apply the caching on all the tracks, but that takes a lot of space on device.

Test URL: https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.mp4/.m3u8

Any help is greatly appreciated!","['question', 'needs triage']",['marcbaechinger'],,0
11005,video play error in first 5second ,closed,2023-02-21 07:20:42,2023-04-24 01:05:38,2023-02-22 11:35:37,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

oppo find n

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

demo

### Expected result

play succes

### Actual result

<details>
  <summary>logs</summary>
/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=2 outputFps=3 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#119] DEBUG: elapsed: mInputMetEos 14, hasPendingOutputsInClient 0, n=0 [in=0 pipeline=0 out=10]
D/PipelineWatcher(10725): [0xb400007c495ed880] elapsed: mFramesInPipeline 0, n 14
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#754] DEBUG: elapsed: mInputMetEos 6, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=2]
D/PipelineWatcher(10725): [0xb400007c495ede80] elapsed: mFramesInPipeline 2, n 6
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecConfig(10725): c2 config diff is   c2::u32 output.delay.value = 12
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#119] onWorkDone: updating output delay 12
I/CCodecBufferChannel(10725): [c2.qti.avc.decoder#119] onWorkDone: updating max output delay 19
D/Codec2-OutputBufferQueue(10725): set max dequeue count 19 from update
D/CCodecConfig(10725): c2 config diff is   c2::u32 raw.color.matrix = 1
D/CCodecConfig(10725):   c2::u32 raw.color.primaries = 1
D/CCodecConfig(10725):   c2::u32 raw.color.range = 2
D/CCodecConfig(10725):   c2::u32 raw.color.transfer = 3
D/CCodecConfig(10725):   c2::u32 raw.crop.height = 720
D/CCodecConfig(10725):   c2::u32 raw.crop.left = 0
D/CCodecConfig(10725):   c2::u32 raw.crop.top = 0
D/CCodecConfig(10725):   c2::u32 raw.crop.width = 1280
D/CCodecBuffers(10725): [c2.qti.avc.decoder#119:2D-Output] popFromStashAndRegister: at 1000005000000us, output format changed to AMessage(what = 0x00000000) = {
D/CCodecBuffers(10725):   int32_t android._color-format = 0
D/CCodecBuffers(10725):   int32_t android._video-scaling = 1
D/CCodecBuffers(10725):   int32_t android._dataspace = 260
D/CCodecBuffers(10725):   int32_t color-standard = 1
D/CCodecBuffers(10725):   int32_t color-range = 2
D/CCodecBuffers(10725):   int32_t color-transfer = 3
D/CCodecBuffers(10725):   int32_t sar-height = 1
D/CCodecBuffers(10725):   int32_t rotation-degrees = 0
D/CCodecBuffers(10725):   Buffer hdr-static-info = {
D/CCodecBuffers(10725):     00000000:  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
D/CCodecBuffers(10725):     00000010:  00 00 00 00 00 00 00 00  00                       .........
D/CCodecBuffers(10725):   }
D/CCodecBuffers(10725):   int32_t sar-width = 1
D/CCodecBuffers(10725):   Rect crop(0, 0, 1279, 719)
D/CCodecBuffers(10725):   int32_t width = 1280
D/CCodecBuffers(10725):   int32_t feature-secure-playback = 0
D/CCodecBuffers(10725):   int32_t frame-rate = 28
D/CCodecBuffers(10725):   int32_t height = 720
D/CCodecBuffers(10725):   int32_t max-height = 720
D/CCodecBuffers(10725):   int32_t max-width = 1280
D/CCodecBuffers(10725):   string mime = ""video/raw""
D/CCodecBuffers(10725):   int32_t priority = 0
D/CCodecBuffers(10725):   int32_t color-format = 2130708361
D/CCodecBuffers(10725): }
D/OplusCCodec(10725): signalSetParameters [414]: (0xb400007c492fec00)
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=5 outputFps=5 renderFps=1, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c3b7f8828 : 0(0 size) total buffers - 0(0 size) used buffers - 21/27 (recycle/alloc) - 16/24 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 1, evicted: 1
D/TrafficStats(10725): tagSocket(145) with statsTag=0xffffffff, statsUid=-1
I/System.out(10725): [OkHttp] sendRequest>>
I/System.out(10725): [OkHttp] sendRequest<<
I/System.out(10725): [okhttp]:check permission begin!
I/System.out(10725): [okhttp]:not MMS!
I/System.out(10725): [okhttp]:not Email!
D/TrafficStats(10725): tagSocket(145) with statsTag=0xffffffff, statsUid=-1
I/System.out(10725): [OkHttp] sendRequest>>
I/System.out(10725): [OkHttp] sendRequest<<
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=4 outputFps=3 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c4959f028 : 0(0 size) total buffers - 0(0 size) used buffers - 85/94 (recycle/alloc) - 14/91 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c285b7628 : 5(40960 size) total buffers - 0(0 size) used buffers - 14/19 (recycle/alloc) - 5/19 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c6fc37a28 : 0(0 size) total buffers - 0(0 size) used buffers - 166/181 (recycle/alloc) - 10/176 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 4, evicted: 3
I/System.out(10725): [okhttp]:check permission begin!
I/System.out(10725): [okhttp]:not MMS!
I/System.out(10725): [okhttp]:not Email!
I/System.out(10725): [OkHttp] sendRequest>>
I/System.out(10725): [OkHttp] sendRequest<<
I/DMCodecAdapterFactory(10725): Creating an asynchronous MediaCodec adapter for track type video
D/MediaCodec(10725): CreateByComponentName: name c2.qti.avc.decoder
D/OplusCCodec(10725): OplusCCodec [125]: (0xb400007c492fe500)
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/MediaCodec(10725): [0xb400007c3b7cf000] init: CCodec 0xb400007c492fe500, CCodecBufferChannel 0xb400007c503c1a18
D/MediaCodec(10725): [0xb400007c3b7cf000] setState: 1
D/CCodec  (10725): allocate(c2.qti.avc.decoder)
I/CCodec  (10725): setting up 'default' as default (vendor) store
I/CCodec  (10725): Created component [c2.qti.avc.decoder]
D/CCodecBufferChannel(10725): [0xb400007c503c1a18] setComponent: mName c2.qti.avc.decoder#353, mPipelineWatcher 0xb400007c503c1e80
D/CCodecConfig(10725): read media type: video/avc
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_top_field.misr_dpb_luma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_top_field.misr_dpb_chroma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_top_field.misr_opb_luma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_top_field.misr_opb_chroma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_bottom_field.misr_dpb_luma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_bottom_field.misr_dpb_chroma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_bottom_field.misr_opb_luma
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: vendor.qti-ext-dec-info-misr.misr_info_bottom_field.misr_opb_chroma
D/ReflectedParamUpdater(10725): ignored struct field vendor.qti-ext-dec-panscan.window
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: output.buffers.pool-ids.values
D/CCodecConfig(10725): ignoring local param raw.size (0xd2001800) as it is already supported
D/CCodecConfig(10725): ignoring local param default.color (0x5200180b) as it is already supported
D/CCodecConfig(10725): ignoring local param raw.hdr-static-info (0xd200180a) as it is already supported
I/CCodecConfig(10725): query failed after returning 17 values (BAD_INDEX)
D/CCodecConfig(10725): c2 config diff is Dict {
D/CCodecConfig(10725):   c2::i32 algo.priority.value = 0
D/CCodecConfig(10725):   c2::float algo.rate.value = 30
D/CCodecConfig(10725):   c2::u32 algo.secure-mode.value = 0
D/CCodecConfig(10725):   c2::float coded.frame-rate.value = 30
D/CCodecConfig(10725):   c2::u32 coded.pl.level = 0
D/CCodecConfig(10725):   c2::u32 coded.pl.profile = 20484
D/CCodecConfig(10725):   c2::u32 coded.vui.color.matrix = 255
D/CCodecConfig(10725):   c2::u32 coded.vui.color.primaries = 0
D/CCodecConfig(10725):   c2::u32 coded.vui.color.range = 0
D/CCodecConfig(10725):   c2::u32 coded.vui.color.transfer = 255
D/CCodecConfig(10725):   c2::u32 default.color.matrix = 0
D/CCodecConfig(10725):   c2::u32 default.color.primaries = 0
D/CCodecConfig(10725):   c2::u32 default.color.range = 0
D/CCodecConfig(10725):   c2::u32 default.color.transfer = 0
D/CCodecConfig(10725):   c2::u32 input.buffers.max-size.value = 7077888
D/CCodecConfig(10725):   c2::u32 input.delay.value = 0
D/CCodecConfig(10725):   string input.media-type.value = ""video/avc""
D/CCodecConfig(10725):   c2::u32 output.delay.value = 8
D/CCodecConfig(10725):   string output.media-type.value = ""video/raw""
D/CCodecConfig(10725):   c2::u32 raw.color.matrix = 255
D/CCodecConfig(10725):   c2::u32 raw.color.primaries = 0
D/CCodecConfig(10725):   c2::u32 raw.color.range = 0
D/CCodecConfig(10725):   c2::u32 raw.color.transfer = 255
D/CCodecConfig(10725):   c2::float raw.hdr-static-info.mastering.blue.x = 0
D/CCodecConfig(10725):   c2::float raw.hdr-static-info.mastering.blue.y = 0
D/CCodecConfig(10725):   c2::float raw.hdr-static-info.mastering.gre
W/ColorUtils(10725): expected specified color aspects (0:0:255:255)
D/MediaCodec(10725): [0xb400007c3b7cf000] setState: 2
I/MediaCodec(10725): MediaCodec will operate in async mode
I/MediaCodec(10725): [0xb400007c3b7cf000] [c2.qti.avc.decoder] configure, format : AMessage(what = 0x00000000) = {
I/MediaCodec(10725):   Buffer csd-1 = {
I/MediaCodec(10725):     00000000:  00 00 00 01 68 ea ef 2c                           ....h..,
I/MediaCodec(10725):   }
I/MediaCodec(10725):   int32_t max-height = 720
I/MediaCodec(10725):   string log-session-id = ""jLJaKWBvq3WMDLOf""
I/MediaCodec(10725):   int32_t max-width = 1280
I/MediaCodec(10725):   string mime = ""video/avc""
I/MediaCodec(10725):   int32_t width = 1280
I/MediaCodec(10725):   int32_t priority = 0
I/MediaCodec(10725):   float frame-rate = 28.149120
I/MediaCodec(10725):   int32_t rotation-degrees = 0
I/MediaCodec(10725):   int32_t max-input-size = 224934
I/MediaCodec(10725):   int32_t height = 720
I/MediaCodec(10725):   Buffer csd-0 = {
I/MediaCodec(10725):     00000000:  00 00 00 01 67 64 00 1e  ac d9 40 50 05 bb 01 10  ....gd....@P....
I/MediaCodec(10725):     00000010:  00 00 03 00 10 00 00 03  03 c0 f1 62 d9 60        ...........b.`
I/MediaCodec(10725):   }
I/MediaCodec(10725): }
D/MediaCodec(10725): [0xb400007c3b7cf000] [c2.qti.avc.decoder] connectToSurface: surface 0xb400007c25c9d000, mSurface 0x0
D/SurfaceUtils(10725): connecting to surface 0xb400007c25c9d010, reason connectToSurface
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) connect: api=3 producerControlledByApp=true
I/MediaCodec(10725): [c2.qti.avc.decoder] setting surface generation to 10982409
D/SurfaceUtils(10725): disconnecting from surface 0xb400007c25c9d010, reason connectToSurface(reconnect)
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) disconnect: api 3
D/SurfaceUtils(10725): connecting to surface 0xb400007c25c9d010, reason connectToSurface(reconnect)
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) connect: api=3 producerControlledByApp=true
D/MediaCodec(10725): [0xb400007c3b7cf000] setState: 3
D/OplusCCodec(10725): debug enabled , debugType :0
D/OplusCCodec(10725): [initiateConfigureComponent:L333] OplusFeedbackInfo  mFeedbackID:-5476376613078702848
W/AString (10725): ctor got NULL, using empty string instead
D/AtlasEventUploadUtils(10725): setEvent event:atlas_event_video_monitor_network_switch
D/ListServiceUtils(10725): checkInListByUid module:check-first-IRAP uid:10432 cost 153us return 0
D/ListServiceUtils(10725): checkInListByUid module:notify-network-optimize uid:10432 cost 125us return 0
D/ListServiceUtils(10725): checkInListByUid module:video-statistics uid:10432 cost 118us return 0
D/CCodec  (10725): [c2.qti.avc.decoder] buffers are bound to CCodec for this session
D/CCodecConfig(10725): no c2 equivalents for csd-1
D/CCodecConfig(10725): no c2 equivalents for log-session-id
D/CCodecConfig(10725): no c2 equivalents for native-window
D/CCodecConfig(10725): no c2 equivalents for flags
D/CCodecConfig(10725): c2 config diff is   c2::float coded.frame-rate.value = 28.1491
D/CCodecConfig(10725):   c2::u32 input.buffers.max-size.value = 1384448
D/CCodecConfig(10725):   c2::u32 raw.max-size.height = 720
D/CCodecConfig(10725):   c2::u32 raw.max-size.width = 1280
D/CCodecConfig(10725):   c2::u32 raw.size.height = 720
D/CCodecConfig(10725):   c2::u32 raw.size.width = 1280
W/Codec2Client(10725): query -- param skipped: index = 1107298332.
D/CCodec  (10725): client requested max input size 224934, which is smaller than what component recommended (1384448); overriding with component recommendation.
W/CCodec  (10725): This behavior is subject to change. It is recommended that app developers double check whether the requested max input size is in reasonable range.
D/CCodec  (10725): encoding statistics level = 0
D/CCodec  (10725): setup formats input: AMessage(what = 0x00000000) = {
D/CCodec  (10725):   int32_t feature-secure-playback = 0
D/CCodec  (10725):   int32_t frame-rate = 28
D/CCodec  (10725):   int32_t height = 720
D/CCodec  (10725):   int32_t max-input-size = 1384448
D/CCodec  (10725):   string mime = ""video/avc""
D/CCodec  (10725):   int32_t priority = 0
D/CCodec  (10725):   int32_t profile = 8
D/CCodec  (10725):   int32_t width = 1280
D/CCodec  (10725):   Rect crop(0, 0, 1279, 719)
D/CCodec  (10725): }
D/CCodec  (10725): setup formats output: AMessage(what = 0x00000000) = {
D/CCodec  (10725):   int32_t android._color-format = 0
D/CCodec  (10725):   int32_t android._video-scaling = 1
D/CCodec  (10725):   int32_t android._dataspace = 260
D/CCodec  (10725):   int32_t color-standard = 130817
D/CCodec  (10725):   int32_t color-range = 2
D/CCodec  (10725):   int32_t color-transfer = 65791
D/CCodec  (10725):   int32_t sar-height = 1
D/CCodec  (10725):   int32_t rotation-degrees = 0
D/CCodec  (10725):   Buffer hdr-static-info = {
D/CCodec  (10725):     00000000:  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
D/CCodec  (10725):     00000010:  00 00 00 00 00 00 00 00  00                       .........
D/CCodec  (10725):   }
D/CCodec  (10725):   int32_t sar-width = 1
D/CCodec  (10725):   Rect crop(0, 0, 1279, 719)
D/CCodec  (10725):   int32_t width = 1280
D/CCodec  (10725):   int32_t feature-secure-playback = 0
D/CCodec  (10725):   int32_t frame-rate = 28
D/CCodec  (10725):   int32_t height = 720
D/CCodec  (10725):   int32_t max-height = 720
D/CCodec  (10725):   int32_t max-width = 1280
D/CCodec  (10725):   string mime = ""video/raw""
D/CCodec  (10725):   int32_t priority = 0
D/CCodec  (10725):   int32_t color-format = 2130708361
D/CCodec  (10725): }
I/CCodecConfig(10725): query failed after returning 17 values (BAD_INDEX)
D/MediaCodec(10725): [0xb400007c3b7cf000] setState: 4
D/MediaCodec(10725): keep callback message for reclaim
D/MediaCodec(10725): [0xb400007c3b7cf000] setState: 5
W/Codec2Client(10725): query -- param skipped: index = 1342179345.
W/Codec2Client(10725): query -- param skipped: index = 2415921170.
W/Codec2Client(10725): query -- param skipped: index = 1610614798.
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Query input allocators returned 0 params => BAD_INDEX (6)
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007cd54cd628 : 5(6922240 size) total buffers - 4(5537792 size) used buffers - 10/15 (recycle/alloc) - 8/13 (fetch/transfer)
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Created input block pool with allocatorID 16 => poolID 27 - OK (0)
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] start: max output delay 19
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Query output allocators returned 0 params => BAD_INDEX (6)
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Query output surface allocator returned 0 params => BAD_INDEX (6)
I/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Created output block pool with allocatorID 18 => poolID 10359 - OK
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Configured output block pool ids 10359 => OK
D/CCodecBufferChannel(10725): [0xb400007c503c1a18] [c2.qti.avc.decoder#353] start: output->outputDelay 8, output->numSlots 12
D/Codec2-OutputBufferQueue(10725): remote graphic buffer migration 0/0
D/Codec2Client(10725): setOutputSurface -- failed to set consumer usage (6/BAD_INDEX)
D/Codec2Client(10725): setOutputSurface -- generation=10982409 consumer usage=0x900
D/Codec2Client(10725): Surface configure completed
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] start: updating output delay 8
D/MediaCodec(10725): [0xb400007c3b7cf000] setState: 6
D/BufferPoolAccessor2.0(10725): Destruction - bufferpool2 0xb400007c4959f028 cached: 0/0M, 0/0% in use; allocs: 94, 90% recycled; transfers: 91, 85% unfetched
D/BufferPoolAccessor2.0(10725): Destruction - bufferpool2 0xb400007c3b7f8828 cached: 0/0M, 0/0% in use; allocs: 27, 78% recycled; transfers: 24, 33% unfetched
I/DMCodecAdapterFactory(10725): Creating an asynchronous MediaCodec adapter for track type audio
D/CCodecConfig(10725): c2 config diff is   c2::u32 output.delay.value = 10
D/MediaCodec(10725): CreateByComponentName: name c2.android.aac.decoder
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] onWorkDone: updating output delay 10
I/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] onWorkDone: updating max output delay 17
D/Codec2-OutputBufferQueue(10725): set max dequeue count 17 from update
D/OplusCCodec(10725): OplusCCodec [125]: (0xb400007c492fea40)
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/MediaCodec(10725): [0xb400007c2853f000] init: CCodec 0xb400007c492fea40, CCodecBufferChannel 0xb400007c1ec2b018
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] Ignoring stale input buffer done callback: last flush index = 0, frameIndex = 0
D/MediaCodec(10725): [0xb400007c2853f000] setState: 1
D/CCodec  (10725): allocate(c2.android.aac.decoder)
I/CCodec  (10725): setting up 'default' as default (vendor) store
I/CCodec  (10725): Created component [c2.android.aac.decoder]
D/CCodecBufferChannel(10725): [0xb400007c1ec2b018] setComponent: mName c2.android.aac.decoder#224, mPipelineWatcher 0xb400007c1ec2b480
D/CCodecConfig(10725): read media type: audio/mp4a-latm
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: algo.buffers.max-count.values
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: output.subscribed-indices.values
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: input.buffers.allocator-ids.values
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: output.buffers.allocator-ids.values
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: algo.buffers.allocator-ids.values
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: output.buffers.pool-ids.values
D/ReflectedParamUpdater(10725): extent() != 1 for single value type: algo.buffers.pool-ids.values
I/CCodecConfig(10725): query failed after returning 20 values (BAD_INDEX)
D/CCodecConfig(10725): c2 config diff is Dict {
D/CCodecConfig(10725):   c2::u32 coded.aac-packaging.value = 0
D/CCodecConfig(10725):   c2::u32 coded.bitrate.value = 64000
D/CCodecConfig(10725):   c2::u32 coded.pl.level = 0
D/CCodecConfig(10725):   c2::u32 coded.pl.profile = 8192
D/CCodecConfig(10725):   c2::i32 coding.drc.album-mode.value = 0
D/CCodecConfig(10725):   c2::float coding.drc.attenuation-factor.value = 1
D/CCodecConfig(10725):   c2::float coding.drc.boost-factor.value = 1
D/CCodecConfig(10725):   c2::i32 coding.drc.compression-mode.value = 3
D/CCodecConfig(10725):   c2::i32 coding.drc.effect-type.value = 3
D/CCodecConfig(10725):   c2::float coding.drc.encoded-level.value = 0.25
D/CCodecConfig(10725):   c2::float coding.drc.reference-level.value = -16
D/CCodecConfig(10725):   c2::u32 input.buffers.max-size.value = 8192
D/CCodecConfig(10725):   c2::u32 input.delay.value = 0
D/CCodecConfig(10725):   string input.media-type.value = ""audio/mp4a-latm""
D/CCodecConfig(10725):   c2::u32 output.delay.value = 2
D/CCodecConfig(10725):   c2::float output.drc.output-loudness.value = 0.25
D/CCodecConfig(10725):   string output.media-type.value = ""audio/raw""
D/CCodecConfig(10725):   c2::u32 raw.channel-count.value = 1
D/CCodecConfig(10725):   c2::u32 raw.channel-mask.value = 0
D/CCodecConfig(10725):   c2::u32 raw.max-channel-count.value = 8
D/CCodecConfig(10725):   c2::u32 raw.sample-rate.value = 44100
D/CCodecConfig(10725): }
D/MediaCodec(10725): [0xb400007c2853f000] setState: 2
I/MediaCodec(10725): MediaCodec will operate in async mode
I/MediaCodec(10725): [0xb400007c2853f000] [c2.android.aac.decoder] configure, format : AMessage(what = 0x00000000) = {
I/MediaCodec(10725):   string log-session-id = ""jLJaKWBvq3WMDLOf""
I/MediaCodec(10725):   int32_t sample-rate = 22050
I/MediaCodec(10725):   string mime = ""audio/mp4a-latm""
I/MediaCodec(10725):   int32_t channel-count = 2
I/MediaCodec(10725):   int32_t priority = 0
I/MediaCodec(10725):   int32_t max-output-channel-count = 99
I/MediaCodec(10725):   int32_t max-input-size = 660
I/MediaCodec(10725):   Buffer csd-0 = {
I/MediaCodec(10725):     00000000:  13 90                                             ..
I/MediaCodec(10725):   }
I/MediaCodec(10725): }
D/MediaCodec(10725): [0xb400007c2853f000] setState: 3
D/OplusCCodec(10725): debug enabled , debugType :0
D/OplusCCodec(10725): [initiateConfigureComponent:L333] OplusFeedbackInfo  mFeedbackID:-5476376613078701504
D/CCodec  (10725): [c2.android.aac.decoder] buffers are bound to CCodec for this session
D/CCodecConfig(10725): no c2 equivalents for log-session-id
D/CCodecConfig(10725): no c2 equivalents for flags
D/CCodecConfig(10725): config failed => CORRUPTED
D/CCodecConfig(10725): c2 config diff is   c2::u32 raw.channel-count.value = 2
D/CCodecConfig(10725):   c2::u32 raw.sample-rate.value = 22050
W/Codec2Client(10725): query -- param skipped: index = 1107298332.
D/CCodec  (10725): client requested max input size 660, which is smaller than what component recommended (8192); overriding with component recommendation.
W/CCodec  (10725): This behavior is subject to change. It is recommended that app developers double check whether the requested max input size is in reasonable range.
D/CCodec  (10725): encoding statistics level = 0
D/CCodec  (10725): setup formats input: AMessage(what = 0x00000000) = {
D/CCodec  (10725):   int32_t aac-drc-album-mode = 0
D/CCodec  (10725):   int32_t aac-drc-boost-level = 127
D/CCodec  (10725):   int32_t aac-drc-cut-level = 127
D/CCodec  (10725):   int32_t aac-drc-effect-type = 3
D/CCodec  (10725):   int32_t aac-encoded-target-level = -1
D/CCodec  (10725):   int32_t aac-max-output-channel_count = 8
D/CCodec  (10725):   int32_t aac-target-ref-level = 64
D/CCodec  (10725):   int32_t bitrate = 64000
D/CCodec  (10725):   int32_t channel-count = 2
D/CCodec  (10725):   int32_t channel-mask = 0
D/CCodec  (10725):   int32_t level = 0
D/CCodec  (10725):   int32_t max-input-size = 8192
D/CCodec  (10725):   int32_t max-output-channel-count = 8
D/CCodec  (10725):   string mime = ""audio/mp4a-latm""
D/CCodec  (10725):   int32_t profile = 2
D/CCodec  (10725):   int32_t sample-rate = 22050
D/CCodec  (10725): }
D/CCodec  (10725): setup formats output: AMessage(what = 0x00000000) = {
D/CCodec  (10725):   int32_t aac-drc-album-mode = 0
D/CCodec  (10725):   int32_t aac-drc-boost-level = 127
D/CCodec  (10725):   int32_t aac-drc-cut-level = 127
D/CCodec  (10725):   int32_t aac-drc-effect-type = 3
D/CCodec  (10725):   int32_t aac-drc-output-loudness = -1
D/CCodec  (10725):   int32_t aac-encoded-target-level = -1
D/CCodec  (10725):   int32_t aac-max-output-channel_count = 8
D/CCodec  (10725):   int32_t aac-target-ref-level = 64
D/CCodec  (10725):   int32_t channel-count = 2
D/CCodec  (10725):   int32_t channel-mask = 0
D/CCodec  (10725):   int32_t max-output-channel-count = 8
D/CCodec  (10725):   string mime = ""audio/raw""
D/CCodec  (10725):   int32_t sample-rate = 22050
D/CCodec  (10725):   int32_t android._config-pcm-encoding = 2
D/CCodec  (10725): }
I/CCodecConfig(10725): query failed after returning 20 values (BAD_INDEX)
D/MediaCodec(10725): [0xb400007c2853f000] setState: 4
D/MediaCodec(10725): keep callback message for reclaim
D/MediaCodec(10725): [0xb400007c2853f000] setState: 5
W/Codec2Client(10725): query -- param skipped: index = 1342179345.
W/Codec2Client(10725): query -- param skipped: index = 2415921170.
W/Codec2Client(10725): query -- param skipped: index = 1610614798.
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] Created input block pool with allocatorID 16 => poolID 28 - OK (0)
D/BufferPoolAccessor2.0(10725): Destruction - bufferpool2 0xb400007c6fc37a28 cached: 0/0M, 0/0% in use; allocs: 181, 92% recycled; transfers: 176, 94% unfetched
I/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] Created output block pool with allocatorID 16 => poolID 574 - OK
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] Configured output block pool ids 574 => OK
D/CCodecBufferChannel(10725): [0xb400007c1ec2b018] [c2.android.aac.decoder#224] start: output->outputDelay 2, output->numSlots 6
D/CCodecBuffers(10725): [c2.android.aac.decoder#224:1D-Output.Impl[N]] converted 0 buffers to array mode of 6
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] start: updating output delay 2
D/MediaCodec(10725): [0xb400007c2853f000] setState: 6
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=4 outputFps=5 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=2 outputFps=3 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] DEBUG: elapsed: mInputMetEos 14, hasPendingOutputsInClient 0, n=0 [in=0 pipeline=0 out=10]
D/PipelineWatcher(10725): [0xb400007c503c1e80] elapsed: mFramesInPipeline 0, n 14
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] DEBUG: elapsed: mInputMetEos 6, hasPendingOutputsInClient 0, n=0 [in=0 pipeline=0 out=2]
D/PipelineWatcher(10725): [0xb400007c1ec2b480] elapsed: mFramesInPipeline 2, n 6
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#119] DEBUG: elapsed: mInputMetEos 16, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=12]
D/PipelineWatcher(10725): [0xb400007c495ed880] elapsed: mFramesInPipeline 2, n 16
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=4 outputFps=4 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecConfig(10725): c2 config diff is   c2::u32 raw.channel-mask.value = 12
D/CCodecBuffers(10725): [c2.android.aac.decoder#224:Output[N]] popFromStashAndRegister: at 1000000000000us, output format changed to AMessage(what = 0x00000000) = {
D/CCodecBuffers(10725):   int32_t aac-drc-album-mode = 0
D/CCodecBuffers(10725):   int32_t aac-drc-boost-level = 127
D/CCodecBuffers(10725):   int32_t aac-drc-cut-level = 127
D/CCodecBuffers(10725):   int32_t aac-drc-effect-type = 3
D/CCodecBuffers(10725):   int32_t aac-drc-output-loudness = -1
D/CCodecBuffers(10725):   int32_t aac-encoded-target-level = -1
D/CCodecBuffers(10725):   int32_t aac-max-output-channel_count = 8
D/CCodecBuffers(10725):   int32_t aac-target-ref-level = 64
D/CCodecBuffers(10725):   int32_t channel-count = 2
D/CCodecBuffers(10725):   int32_t channel-mask = 12
D/CCodecBuffers(10725):   int32_t max-output-channel-count = 8
D/CCodecBuffers(10725):   string mime = ""audio/raw""
D/CCodecBuffers(10725):   int32_t sample-rate = 22050
D/CCodecBuffers(10725):   int32_t android._config-pcm-encoding = 2
D/CCodecBuffers(10725): }
D/AudioTrackExtImpl(10725): AudioTrackExtImpl init
D/AudioTrack(10725): set() streamType -1, sampleRate 22050, format 0x1, channelMask 0x3, frameCount 7088, flags #0, notificationFrames 0, sessionId 2897, transferType 3, uid -1, pid -1
D/AudioTrack(10725): set(): Building AudioTrack with attributes: usage=1 content=3 flags=0xa00 tags=[]
I/AudioTrack(10725): createTrack_l(567) on outputId(29) : 0xb400007c1ec2b600, mCblk = 0x7d79a08100,  mLatency = 430, mAfLatency = 109, frameCount = 7088, mSampleRate = 22050, mFlags = 0x8, mReqFrameCount = 7088, mNotificationFramesAct = 3544
D/ListServiceUtils(10725): checkInListByUid module:change-futex-timeout uid:10432 cost 128us return 0
D/AudioTrack(10725): setVolume left 1.000 right 1.000 , callingPid 10725
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
V/AutofillManager(10725): requestHideFillUi(null): anchor = null
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=4 outputFps=3 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
V/AutofillManager(10725): requestHideFillUi(null): anchor = null
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=3 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] DEBUG: elapsed: mInputMetEos 6, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=2]
D/PipelineWatcher(10725): [0xb400007c1ec2b480] elapsed: mFramesInPipeline 2, n 6
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#119] DEBUG: elapsed: mInputMetEos 16, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=12]
D/PipelineWatcher(10725): [0xb400007c495ed880] elapsed: mFramesInPipeline 6, n 16
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c1ff30e28 : 5(40960 size) total buffers - 4(32768 size) used buffers - 11/16 (recycle/alloc) - 11/13 (fetch/transfer)
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007cd5f57e28 : 4(5537792 size) total buffers - 4(5537792 size) used buffers - 2/6 (recycle/alloc) - 2/3 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 4, evicted: 1
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): send video stutter message MM_FB_EventID#11002#ClientPid#10725#Component#c2.qti.avc.decoder#VideoInputFps#0#VideoOutputFps#0#VideoRenderFps#0#VideoHeight#720#VideoWidth#1280#IsMediaPlayer#0#LogLevel#3#FpsArray#2/0/0/0/0/0#ModifiedVersion#5
D/AtlasEventUploadUtils(10725): setEvent event:atlas_event_video_stutter
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007cd54cd628 : 5(6922240 size) total buffers - 4(5537792 size) used buffers - 20/26 (recycle/alloc) - 12/28 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 1, evicted: 1
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] DEBUG: elapsed: mInputMetEos 6, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=2]
D/PipelineWatcher(10725): [0xb400007c1ec2b480] elapsed: mFramesInPipeline 2, n 6
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): send video stutter message MM_FB_EventID#11002#ClientPid#10725#Component#c2.qti.avc.decoder#VideoInputFps#0#VideoOutputFps#0#VideoRenderFps#0#VideoHeight#720#VideoWidth#1280#IsMediaPlayer#0#LogLevel#3#FpsArray#3/0/0/0/0/0#ModifiedVersion#5
D/AtlasEventUploadUtils(10725): setEvent event:atlas_event_video_stutter
V/AutofillManager(10725): requestHideFillUi(null): anchor = null
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): [sendFPSInfo:L430] input/output/render 0fps over 10s, reduce print fps log
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c1ff30e28 : 5(40960 size) total buffers - 0(0 size) used buffers - 14/19 (recycle/alloc) - 14/19 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 1, evicted: 1
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd3634c00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): [sendFPSInfo:L430] input/output/render 0fps over 10s, reduce print fps log
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
V/AutofillManager(10725): requestHideFillUi(null): anchor = null
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007cd5f57e28 : 4(5537792 size) total buffers - 4(5537792 size) used buffers - 2/6 (recycle/alloc) - 2/4 (fetch/transfer)
D/CCodecConfig(10725): c2 config diff is   c2::u32 raw.color.matrix = 1
D/CCodecConfig(10725):   c2::u32 raw.color.primaries = 1
D/CCodecConfig(10725):   c2::u32 raw.color.range = 2
D/CCodecConfig(10725):   c2::u32 raw.color.transfer = 3
D/CCodecConfig(10725):   c2::u32 raw.crop.height = 720
D/CCodecConfig(10725):   c2::u32 raw.crop.left = 0
D/CCodecConfig(10725):   c2::u32 raw.crop.top = 0
D/CCodecConfig(10725):   c2::u32 raw.crop.width = 1280
D/CCodecBuffers(10725): [c2.qti.avc.decoder#353:2D-Output] popFromStashAndRegister: at 1000005000000us, output format changed to AMessage(what = 0x00000000) = {
D/CCodecBuffers(10725):   int32_t android._color-format = 0
D/CCodecBuffers(10725):   int32_t android._video-scaling = 1
D/CCodecBuffers(10725):   int32_t android._dataspace = 260
D/CCodecBuffers(10725):   int32_t color-standard = 1
D/CCodecBuffers(10725):   int32_t color-range = 2
D/CCodecBuffers(10725):   int32_t color-transfer = 3
D/CCodecBuffers(10725):   int32_t sar-height = 1
D/CCodecBuffers(10725):   int32_t rotation-degrees = 0
D/CCodecBuffers(10725):   Buffer hdr-static-info = {
D/CCodecBuffers(10725):     00000000:  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  ................
D/CCodecBuffers(10725):     00000010:  00 00 00 00 00 00 00 00  00                       .........
D/CCodecBuffers(10725):   }
D/CCodecBuffers(10725):   int32_t sar-width = 1
D/CCodecBuffers(10725):   Rect crop(0, 0, 1279, 719)
D/CCodecBuffers(10725):   int32_t width = 1280
D/CCodecBuffers(10725):   int32_t feature-secure-playback = 0
D/CCodecBuffers(10725):   int32_t frame-rate = 28
D/CCodecBuffers(10725):   int32_t height = 720
D/CCodecBuffers(10725):   int32_t max-height = 720
D/CCodecBuffers(10725):   int32_t max-width = 1280
D/CCodecBuffers(10725):   string mime = ""video/raw""
D/CCodecBuffers(10725):   int32_t priority = 0
D/CCodecBuffers(10725):   int32_t color-format = 2130708361
D/CCodecBuffers(10725): }
D/OplusCCodec(10725): signalSetParameters [414]: (0xb400007c492fe500)
D/AudioTrack(10725): start(567): prior state:STATE_STOPPED output 29 stream 3 session 2897
W/AidlConversion(10725): aidl2legacy_AudioChannelLayout_audio_channel_mask_t: no legacy output audio_channel_mask_t found for AudioChannelLayout{layoutMask: 16}
D/AudioTrack(10725): getTimestamp_l(567): device stall time corrected using current time 571417027213686
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=6 outputFps=4 renderFps=1, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/AtlasEventUploadUtils(10725): setEvent event:atlas_event_video_monitor_network_switch
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c285b7628 : 0(0 size) total buffers - 0(0 size) used buffers - 14/19 (recycle/alloc) - 5/19 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007cd54cd628 : 4(5537792 size) total buffers - 4(5537792 size) used buffers - 20/26 (recycle/alloc) - 12/28 (fetch/transfer)
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=13 outputFps=11 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=1 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c1ff30e28 : 5(40960 size) total buffers - 1(8192 size) used buffers - 54/64 (recycle/alloc) - 19/63 (fetch/transfer)
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] DEBUG: elapsed: mInputMetEos 14, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=10]
D/PipelineWatcher(10725): [0xb400007c503c1e80] elapsed: mFramesInPipeline 6, n 14
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] DEBUG: elapsed: mInputMetEos 6, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=2]
D/PipelineWatcher(10725): [0xb400007c1ec2b480] elapsed: mFramesInPipeline 2, n 6
V/AutofillManager(10725): requestHideFillUi(null): anchor = null
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=0 renderFps=0, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007cd5f57e28 : 5(6922240 size) total buffers - 3(4153344 size) used buffers - 18/23 (recycle/alloc) - 5/24 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 1, evicted: 1
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=0 outputFps=1 renderFps=2, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c285b7628 : 0(0 size) total buffers - 0(0 size) used buffers - 14/19 (recycle/alloc) - 5/19 (fetch/transfer)
D/BufferPoolAccessor2.0(10725): evictor expired: 1, evicted: 1
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=31 outputFps=32 renderFps=29, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/CCodecBufferChannel(10725): [c2.qti.avc.decoder#353] DEBUG: elapsed: mInputMetEos 14, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=10]
D/PipelineWatcher(10725): [0xb400007c503c1e80] elapsed: mFramesInPipeline 5, n 14
D/CCodecBufferChannel(10725): [c2.android.aac.decoder#224] DEBUG: elapsed: mInputMetEos 6, hasPendingOutputsInClient 0, n=1 [in=0 pipeline=0 out=2]
D/PipelineWatcher(10725): [0xb400007c1ec2b480] elapsed: mFramesInPipeline 2, n 6
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
D/PipelineWatcher(10725): [0xb400007c1ec2b480] pipelineFull: too many frames in pipeline (6)
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=30 outputFps=30 renderFps=30, discardFps=0
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferPoolAccessor2.0(10725): bufferpool2 0xb400007c1ff30e28 : 5(40960 size) total buffers - 1(8192 size) used buffers - 167/177 (recycle/alloc) - 19/176 (fetch/transfer)
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=2, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
W/libc    (10725): Access denied finding property ""vendor.oplus.media.vpp.stutter""
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
D/BufferQueueProducer(10725): [SurfaceTexture-0-10725-6](id:29e50000000b,api:3,p:10725,c:10725) waitForFreeSlotThenRelock TIMED_OUT 0 dequeuedCount=16, acquiredCount=1, mMaxAcquiredBufferCount=1, mMaxDequeuedBufferCount=17
I/OplusFeedbackInfo(10725): 0xb400007cd37b2e00 c2.qti.avc.decoder 1280x720 inputFps=29 outputFps=30 renderFps=31, discardFps=0
</details>

### Media

video url 
String path = ""https://bdoss-ys.haier.net/video/2022/11/cf4f5aa2bb1ea313.mp4?AccessKeyId=LTAI5tChAA1VYURjctoKVhRb"";
String path1 = ""https://bdoss-ys.haier.net/video/2022/11/838d405e190fd79a.mp4?AccessKeyId=LTAI5tChAA1VYURjctoKVhRb"";

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['duplicate'],['icbaker'],,4
11004,Transforming HLS Live to MP4 Causes Crash on Android 10 and Newer,open,2023-02-20 21:12:21,2023-05-27 15:02:15,,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Every device that we tested, Android 10, 11, 12, 13

We do not observe this issue on Android versions 9 and lower.

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps


1. modify `demos/transformer/build.gradle` and add the following line at line 83:
```
implementation project(modulePrefix + 'library-hls'),
```
2. Add the HLS Live Stream URL to the Transformer Demo.
 a) add the following HLS Live Stream URL at  aline 91:
  ```
  ""https://voa-ingest.akamaized.net/hls/live/2033876/tvmc07/playlist.m3u8"",
  ```
b) Add the title for the above URL at line 107:
  ```
  ""Test Record HLS Live - akamaized"",
  ```

### Expected result

The media is downloaded and no crash happens.

### Actual result
Download works fine for some HLS URLs, but it fails and app crashes with the following log when using some other HLS URLs:

```
02/20 15:59:44: Launching 'demo-transformer' on 13.5  Freeform (Edited) API 30.
Install successfully finished in 965 ms.
$ adb shell am start -n ""com.google.android.exoplayer2.transformerdemo/com.google.android.exoplayer2.transformerdemo.ConfigurationActivity"" -a android.intent.action.MAIN -c android.intent.category.LAUNCHER
Connected to process 19960 on device '13.5_Freeform_Edited_API_30 [emulator-5554]'.
Capturing and displaying logcat messages from application. This behavior can be disabled in the ""Logcat output"" section of the ""Debugger"" settings page.
I/transformerdem: Late-enabling -Xcheck:jni
I/transformerdem: Unquickening 12 vdex files!
W/transformerdem: Unexpected CPU variant for X86 using defaults: x86
D/NetworkSecurityConfig: No Network Security Config specified, using platform default
D/NetworkSecurityConfig: No Network Security Config specified, using platform default
D/libEGL: loaded /vendor/lib/egl/libEGL_emulation.so
D/libEGL: loaded /vendor/lib/egl/libGLESv1_CM_emulation.so
D/libEGL: loaded /vendor/lib/egl/libGLESv2_emulation.so
W/transformerdem: Accessing hidden method Landroid/view/View;->computeFitSystemWindows(Landroid/graphics/Rect;Landroid/graphics/Rect;)Z (greylist, reflection, allowed)
W/transformerdem: Accessing hidden method Landroid/view/ViewGroup;->makeOptionalFitsSystemWindows()V (greylist, reflection, allowed)
D/HostConnection: HostConnection::get() New Host Connection established 0xed569590, tid 20001
D/HostConnection: HostComposition ext ANDROID_EMU_CHECKSUM_HELPER_v1 ANDROID_EMU_native_sync_v2 ANDROID_EMU_native_sync_v3 ANDROID_EMU_native_sync_v4 ANDROID_EMU_dma_v1 ANDROID_EMU_direct_mem ANDROID_EMU_host_composition_v1 ANDROID_EMU_host_composition_v2 ANDROID_EMU_YUV_Cache ANDROID_EMU_has_shared_slots_host_memory_allocator ANDROID_EMU_sync_buffer_data ANDROID_EMU_read_color_buffer_dma GL_OES_EGL_image_external_essl3 GL_OES_vertex_array_object GL_KHR_texture_compression_astc_ldr ANDROID_EMU_host_side_tracing ANDROID_EMU_gles_max_version_3_0 
W/OpenGLRenderer: Failed to choose config with EGL_SWAP_BEHAVIOR_PRESERVED, retrying without...
D/EGL_emulation: eglCreateContext: 0xed56ada0: maj 3 min 0 rcv 3
D/EGL_emulation: eglMakeCurrent: 0xed56ada0: ver 3 0 (tinfo 0xed8bd970) (first time)
I/Gralloc4: mapper 4.x is not supported
D/HostConnection: createUnique: call
D/HostConnection: HostConnection::get() New Host Connection established 0xed569a60, tid 20001
D/goldfish-address-space: allocate: Ask for block of size 0x100
D/goldfish-address-space: allocate: ioctl allocate returned offset 0x3f1ffc000 size 0x2000
D/HostConnection: HostComposition ext ANDROID_EMU_CHECKSUM_HELPER_v1 ANDROID_EMU_native_sync_v2 ANDROID_EMU_native_sync_v3 ANDROID_EMU_native_sync_v4 ANDROID_EMU_dma_v1 ANDROID_EMU_direct_mem ANDROID_EMU_host_composition_v1 ANDROID_EMU_host_composition_v2 ANDROID_EMU_YUV_Cache ANDROID_EMU_has_shared_slots_host_memory_allocator ANDROID_EMU_sync_buffer_data ANDROID_EMU_read_color_buffer_dma GL_OES_EGL_image_external_essl3 GL_OES_vertex_array_object GL_KHR_texture_compression_astc_ldr ANDROID_EMU_host_side_tracing ANDROID_EMU_gles_max_version_3_0 
I/transformerdem: JIT allocated 74KB for compiled code of void android.view.View.<init>(android.content.Context, android.util.AttributeSet, int, int)
D/OpenGLRenderer: endAllActiveAnimators on 0xe7157cb0 (RippleDrawable) with handle 0xbdf0cc10
I/ExoPlayerImpl: Init 69727d7 [ExoPlayerLib/2.18.3] [generic_x86_arm, sdk_gphone_x86_arm, Google, 30]
I/Choreographer: Skipped 41 frames!  The application may be doing too much work on its main thread.
I/OpenGLRenderer: Davey! duration=756ms; Flags=1, IntendedVsync=1752029272942, Vsync=1752712606248, OldestInputEvent=9223372036854775807, NewestInputEvent=0, HandleInputStart=1752721714436, AnimationStart=1752721843436, PerformTraversalsStart=1752722564436, DrawStart=1752759133436, SyncQueued=1752771589436, SyncStart=1752772867436, IssueDrawCommandsStart=1752772996436, SwapBuffers=1752774992436, FrameCompleted=1752787280436, DequeueBufferDuration=10217000, QueueBufferDuration=1076000, GpuCompleted=0, 
I/OpenGLRenderer: Davey! duration=762ms; Flags=1, IntendedVsync=1752029272942, Vsync=1752712606248, OldestInputEvent=9223372036854775807, NewestInputEvent=0, HandleInputStart=1752721714436, AnimationStart=1752721843436, PerformTraversalsStart=1752722564436, DrawStart=1752788572436, SyncQueued=1752788642436, SyncStart=1752789587436, IssueDrawCommandsStart=1752789785436, SwapBuffers=1752791761436, FrameCompleted=1752793156436, DequeueBufferDuration=154000, QueueBufferDuration=590000, GpuCompleted=72343995342127104, 
I/TetheringManager: registerTetheringEventCallback:com.google.android.exoplayer2.transformerdemo
D/MPEG4Writer: PreAllocation enabled
D/MPEG4Writer: fpathconf _PC_FILESIZEBITS:64
D/MPEG4Writer: File size limit set to 4503599627370495 bytes implicitly
D/MPEG4Writer: MP4WtrCtrlHlpLooper Started
I/MPEG4Writer: limits: 4503599627370495/0 bytes/us, bit rate: -1 bps and the estimated moov size 3192 bytes
D/MPEG4Writer: kWhatNoIOErrorSoFar
I/MPEG4Writer: setStartTimestampUs: 11667
I/MPEG4Writer: Earliest track starting time: 11667
I/MPEG4Writer: setStartTimestampUs: 0
I/MPEG4Writer: Earliest track starting time: 0
A/libc: FORTIFY: write: count 4294967295 > SSIZE_MAX
A/libc: Fatal signal 6 (SIGABRT), code -1 (SI_QUEUE) in tid 20063 (MPEG4Writer), pid 19960 (transformerdemo)
```

### Media

Here are example HLS live streams URL that crash happens:
- https://voa-ingest.akamaized.net/hls/live/2033876/tvmc07/playlist.m3u8
- https://svs.itworkscdn.net/rudawlive/rudawlive.smil/playlist.m3u8

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'low priority']",['andrewlewis'],,10
11003,Is possible to disable trackSelector performance checks?,closed,2023-02-20 14:02:55,2023-04-25 01:05:47,2023-02-23 12:52:11,"I'm using trackSelector to play an hls playlist, the trackSelector will choose the highest quality stream if I have a single player playing, once a second one starts (Picture and picture mode) the quality will drop from 1080p60 to 720p30 or even 480p30 to both players.

This seems to be a performance check from exoplayer, but I can't find it.

**Is this correct? Do we have a performance check?
Is it possible for me to disable it?**

I know that I can remove tracks, but I don’t want to in scenarios of network related lag the player can drop and come back once internet speed is fine, I just wanna remove the performance check.


I'm using dev2 branch head is https://github.com/google/ExoPlayer/commit/128fed81cab33f31dc10898a17475d07d9d82ee0 from last jan 25 https://github.com/google/ExoPlayer/commits/dev-v2?after=9170e6f5118ae56a21cac29bee3b7e909cc5ae6b+174&branch=dev-v2&qualified_name=refs%2Fheads%2Fdev-v2
",['question'],['microkatz'],,4
11002,Mimicking the behavior of REPEAT_MODE_ALL without overhead,closed,2023-02-20 10:34:32,2023-04-23 01:05:25,2023-02-21 10:27:41,"When repeat mode is set to `REPEAT_MODE_ALL`, the player will **_instantly_** repeat the media without any delay overhead. So, I am trying to mimic this behavior by listening to when the player finishes playback of a media item, then seek to 0ms again.

However, this comes with some overhead, whereas `REPEAT_MODE_ALL` literally instantly replays it without any preloading or buffering. 

I tried inspecting the source code but I couldn't put my finger on where the interface for repeat mode is implemented, could you redirect me in the right way ? I want to repeat the media item at will while only using `REPEAT_MODE_OFF`",['duplicate'],['tonihei'],,3
11001,How to synchronously play two identical videos (no audio) on two different phones,closed,2023-02-20 10:18:33,2023-04-22 01:05:16,2023-02-20 10:21:30,"Hello, developer, I learned from searching issuse and some online materials that exolayer is synchronized based on sound. But in videos without sound, the getPositionUs of override MediaCodecAudioRenderer always return 0. So I tried to modify the processOutputBuffer of MediaCodecVideoRenderer, and passed in seekPts as the pts time to synchronize. The effect I want is that the pts time of the two videos is the same, However, the time gap between the two videos has not been shortened. Here is the code I added
```
if (seekPts != -1) {
            long earlyUs = (long) ((presentationTimeUs - seekPts) / playbackSpeed);
            if (isStarted) {
                // Account for the elapsed time since the start of this iteration of the rendering loop.
                earlyUs -= elapsedRealtimeNowUs - elapsedRealtimeUs;
            }
            if (earlyUs < 0) {
                boolean treatDroppedBuffersAsSkipped = joiningDeadlineMs != C.TIME_UNSET;
                if (shouldDropBuffersToKeyframe(earlyUs, elapsedRealtimeUs, isLastBuffer)
                        && maybeDropBuffersToKeyframe(positionUs, treatDroppedBuffersAsSkipped)) {
                    return false;
                }else{
                    skipOutputBuffer(codec, bufferIndex, presentationTimeUs);
                    updateVideoFrameProcessingOffsetCounters(earlyUs);
                    return true;
                }
            } else {
                long releaseTimeNs = System.nanoTime();
                notifyFrameMetadataListener(presentationTimeUs, releaseTimeNs, format);
                if (Util.SDK_INT >= 21) {
                    renderOutputBufferV21(codec, bufferIndex, presentationTimeUs, releaseTimeNs);
                } else {
                    renderOutputBuffer(codec, bufferIndex, presentationTimeUs);
                }
                updateVideoFrameProcessingOffsetCounters(earlyUs);
                seekPts = -1;
                return true;
            }
        }
```
See MediaCodecVideoRender.zip for the complete code,Finally, how can I achieve the pts synchronization of video?
[MediaCodecVideoRenderer.zip](https://github.com/google/ExoPlayer/files/10783306/MediaCodecVideoRenderer.zip)
",['duplicate'],['tonihei'],,1
11000,Seeking into AC4 audio only content with FMP4 subfragments creates discontinuities,closed,2023-02-18 09:23:43,2023-08-15 01:05:04,2023-06-15 07:56:34,"### ExoPlayer Version

2.15.1

### Devices that reproduce the issue

* Samsung S11 with Android 11

### Devices that do not reproduce the issue

Google Pixels as they do not support decoding the Dolby AC-4 codec

### Reproducible in the demo app?

Yes

### Reproduction steps

1. Play attached media
2. Seek the player forward
3. Watch playhead snap to the beginning of the segment instead of seeking to specified point

### Expected result

Player seeks to IFrame as close to specified point as possible, parsing subfragments within the segment accordingly.

### Actual result

Player detects discontinuity and snaps to the closest Iframe at beginning of segment

### Media

Will email clear AC4 media separately 

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'needs triage']",['tonihei'],,44
10999,Incompatibility with http:// mjpeg stream + url auth is not possible gives error,closed,2023-02-18 08:23:49,2023-04-22 01:05:17,2023-02-20 16:59:54,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

Android Note8 Android 10
S7E Android 10

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Prep: Hook up your favorite webcam to snap motioneye raspberry pi and make the http:// stream
Set the Android manifest with all the necessary internet permissions
 android:usesCleartextTraffic=""true"" android:networkSecurityConfig=""@xml/network_security_config"" && perm internet

1. Create control
2. Set its source to an auth (http://user:pswd@13.3.2.21:8085) URL that youve tested in your local browser to know if its working (mjpeg format)
3. See the errors in the debug output window

### Expected result

Just plays stream like a browser

Propositions:
Allow forcing the AUTH containing url instead of filtering it for credentials and trying to handle that behind the scene which currently somehow breaks (might force the general url auth problem)

Add a codec that can handle mjpeg streams like a webview (which currently works) scale to fit without any extra bells and whistles just to offer a way out of this madness

### Actual result

1st test without the AUTH in the http:// url
Fails to play stream with error:
[ExoPlayerImplInternal] Playback error
[ExoPlayerImplInternal]   com.google.android.exoplayer2.ExoPlaybackException: Source error
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.ExoPlayerImplInternal.handleIoException(ExoPlayerImplInternal.java:637)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:607)
[ExoPlayerImplInternal]       at android.os.Handler.dispatchMessage(Handler.java:103)
[ExoPlayerImplInternal]       at android.os.Looper.loop(Looper.java:237)
[ExoPlayerImplInternal]       at android.os.HandlerThread.run(HandlerThread.java:67)
[ExoPlayerImplInternal]   Caused by: com.google.android.exoplayer2.source.UnrecognizedInputFormatException: None of the available extractors (FlvExtractor, FlacExtractor, WavExtractor, FragmentedMp4Extractor, Mp4Extractor, AmrExtractor, PsExtractor, OggExtractor, TsExtractor, MatroskaExtractor, AdtsExtractor, Ac3Extractor, Ac4Extractor, Mp3Extractor, AviExtractor, JpegExtractor) could read the stream.
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.source.BundledExtractorsAdapter.init(BundledExtractorsAdapter.java:92)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$ExtractingLoadable.load(ProgressiveMediaPeriod.java:1017)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.upstream.Loader$LoadTask.run(Loader.java:412)
[ExoPlayerImplInternal]       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)
[ExoPlayerImplInternal]       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)
[ExoPlayerImplInternal]       at java.lang.Thread.run(Thread.java:919)

2nd test with AUTH in the url:
[ExoPlayerImplInternal] Playback error
[ExoPlayerImplInternal]   com.google.android.exoplayer2.ExoPlaybackException: Source error
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.ExoPlayerImplInternal.handleIoException(ExoPlayerImplInternal.java:637)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:609)
[ExoPlayerImplInternal]       at android.os.Handler.dispatchMessage(Handler.java:103)
[ExoPlayerImplInternal]       at android.os.Looper.loop(Looper.java:237)
[ExoPlayerImplInternal]       at android.os.HandlerThread.run(HandlerThread.java:67)
[ExoPlayerImplInternal]   Caused by: com.google.android.exoplayer2.upstream.HttpDataSource$InvalidResponseCodeException: Response code: 401
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.upstream.DefaultHttpDataSource.open(DefaultHttpDataSource.java:413)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.upstream.DefaultDataSource.open(DefaultDataSource.java:262)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.upstream.StatsDataSource.open(StatsDataSource.java:84)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$ExtractingLoadable.load(ProgressiveMediaPeriod.java:1005)
[ExoPlayerImplInternal]       at com.google.android.exoplayer2.upstream.Loader$LoadTask.run(Loader.java:412)
[ExoPlayerImplInternal]       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)
[ExoPlayerImplInternal]       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)
[ExoPlayerImplInternal]       at java.lang.Thread.run(Thread.java:919)

### Media

MJPEG stream http stream with AUTH or without AUTH

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['duplicate'],['icbaker'],,1
10998,Unable to bind a sample queue to TrackGroup with mime type video/avc,closed,2023-02-17 17:33:17,2023-04-19 01:05:57,2023-02-17 18:31:14,"### ExoPlayer Version

2.18.1

### Devices that reproduce the issue

OnePlus 6

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

No

### Reproduction steps

Hi I'm trying to configure a single ExoPlayer instance so that I can give it multiple HLS streams that are all in-sync and renderer out to separate Surfaces. I've followed the steps mentioned in [#2855](https://github.com/google/ExoPlayer/issues/2855) to configure this:
- Inject a custom `RenderersFactory` that creates a video renderer and an audio renderer for each of the sources. For the audio renderers I return null for the `getMediaClock` except for the first so the player has a single clock for playback
- Merge all of the sources using `MergingMediaSource()` to create a single source that can be passed to the player
- Inject a custom `TrackSelector` that then wires up each video and audio track to a corresponding renderer selection
- Send a message to each of the video renderers with a payload of the target surface each video should be rendered into

This works great with **different** HLS streams and I get a fully synchronised pair of videos. However, if I then use the same HLS stream for the two media sources I get the following error after preparing the player (before commencing playback):
```
2023-02-17 17:05:57.878  6034-21398 ExoPlayerImplInternal Playback error
com.google.android.exoplayer2.ExoPlaybackException: Source error
    at com.google.android.exoplayer2.ExoPlayerImplInternal.handleIoException(ExoPlayerImplInternal.java:632)
    at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:608)
    at android.os.Handler.dispatchMessage(Handler.java:102)
    at android.os.Looper.loop(Looper.java:233)
    at android.os.HandlerThread.run(HandlerThread.java:67)
Caused by: com.google.android.exoplayer2.source.hls.SampleQueueMappingException: Unable to bind a sample queue to TrackGroup with mime type video/avc.
    at com.google.android.exoplayer2.source.hls.HlsSampleStream.maybeThrowError(HlsSampleStream.java:62)
    at com.google.android.exoplayer2.BaseRenderer.maybeThrowStreamError(BaseRenderer.java:156)
    at com.google.android.exoplayer2.ExoPlayerImplInternal.doSomeWork(ExoPlayerImplInternal.java:1002)
    at com.google.android.exoplayer2.ExoPlayerImplInternal.handleMessage(ExoPlayerImplInternal.java:490)
    at android.os.Handler.dispatchMessage(Handler.java:102) 
    at android.os.Looper.loop(Looper.java:233) 
    at android.os.HandlerThread.run(HandlerThread.java:67) 
```
I've checked the stack trace here and it seems to trying to bind the same sample queue multiple times to different the 2 different video track groups.

### Expected result

Expected behaviour is the same as if I was using two different HLS streams - it should bind each of these to a separate sample queue and finish preparing without this exception

### Actual result

Actual result is documented in reproduction steps ⬆️

### Media

N/A

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'needs triage']",[],,2
10997,Possible NPE in new ExoPlayer.isTunnelingEnabled method,closed,2023-02-17 15:53:59,2023-04-22 01:05:17,2023-02-20 11:28:45,"### ExoPlayer Version

2.18.2

### Devices that reproduce the issue

Any

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

https://github.com/google/ExoPlayer/blob/f72ca8338399c9e3c19e73fc0779f24baff14d35/library/core/src/main/java/com/google/android/exoplayer2/ExoPlayerImpl.java#L1717

Here a NPE can happen when you have alternative renderers in the factory, ie. having a FfmpegRenderer. In this case, when it's not selected by any track `rendererConfigurations` array will have a null entry in it.

### Expected result

A null check should be added to avoid NPE.

### Actual result

A NPE is thrown when invoking this method with FfmpegRenderer present.

### Media

None

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.","['bug', 'duplicate']",['microkatz'],,1
10996,AV Sync issue in DASH Stream,closed,2023-02-17 10:18:39,2023-04-25 01:05:48,2023-02-23 10:21:04,"### ExoPlayer Version

2.18.3

### Devices that reproduce the issue

All devices.
Tested on Redmi Note 9 Pro, Samsung M32.

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

1. I saved the attached stream in some folder on Phone.
2. Hard coded the path in ""media.exolist.json"".
3. Played the media and observed AV sync.

### Expected result

Media should play with correct AV sync.

### Actual result

AV sync is not present.

### Media

https://drive.google.com/file/d/156XrRCy0Nxk6_u1fgQa9JVEExy3JeLRk/view?usp=sharing 

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bad media'],['tonihei'],,8
10995,r2.18.3,closed,2023-02-16 10:31:24,2023-04-18 01:05:49,2023-02-16 17:03:05,,[],['christosts'],,1
10994,Override ProgressiveMediaSource to update file before play,open,2023-02-16 08:15:20,2023-02-16 11:47:11,,"Hello,

I have a question abuot a good path to acquire this functionality.
I am dynamically downloading MP4 file to local directory which is then used as a ExoPlayer MediaSource. This MediaSource is then played by ExoPlayer in continous loop.

This file is being updated every hour by a different thread and new copy is download and then stored near the current playing one with a .tmp extension.

What functionality i want to achieve is when current MP4 play ends, i want to have a chance to rename file.mp4.tmp to file.mp4 so the new downloaded copy can get playing.

Scenario:
1. file.mp4 plays (length 10 minutes) in a loop
2. New copy of file.mp4 is downloaded and stored as file.mp4.tmp
3. When file.mp4 reaches EOF, rename file.mp4.tmp to file.mp4
4. Play file.mp4 in a loop again
5. Goto :1

I checked that MediaSource is Final so i cannot override it. 

Qeustion is - how is the best minimalistic way to glue into code to get a chance to hit the moment when ExoPlayer closes current file and tries to reopen it so i can make a simple f.renameTo().

I already have ConcatenatingMediaSource which i am using, but this path needs to reorder whole playlist which i don't want to do.

",['question'],['marcbaechinger'],,1
10993,Adding additional format support to ExoPlayer FFMpeg extension?,closed,2023-02-15 16:43:58,2023-06-04 01:05:07,2023-04-04 08:33:12,"I'm considering patching ExoPlayer's FFMpeg extension to add support for more niche progressive audio formats, such as WAVPack or Monkey's Audio. Both of these formats have decoding support in FFMpeg, however they have their own container formats that aren't parsed by ExoPlayer. Moreover, they have no native `MediaCodec` support, which makes these formats sensible only in the context of the FFMpeg extension.

I would like to know the following about this:
1. What would be the general steps to add these additional formats? From what I already know, I would need to write a parser for the container, modify the native code that plugs into FFMpeg to allow access to the decoders I want, and add the required mime type checks to set up the decoder. Could you point to more specific places in the codebase that I should modify?
2. How upstreamable is this? For example, if I could scope the container parsers to the FFMpeg extension, I may try to create a PR. Otherwise, I'd imagine that I will be unable to upstream the changes, as without native `MediaCodec` support, the container parsers I want to write are effectively dead code.

**Note:** This is not a feature request. I am entirely planning to work on this myself.",['question'],['tonihei'],,3
10992,Support SCTE-35 in HLS,open,2023-02-15 15:36:32,2023-02-23 17:23:48,,"### ExoPlayer Version

2.18.1

### Devices that reproduce the issue

Xiaomi Mi Mix 2 (Android 9)

### Devices that do not reproduce the issue

Playing on Google Chrome, the SCTE-35 is receivde properly

### Reproducible in the demo app?

Yes

### Reproduction steps

Play the file (it is a boucle live with SCTE-35 implemented) and wait for the ads

### Expected result

We expect receive and read SCTE-35 metadata, but no metadata entries are received.

### Actual result

Not receiving Metadata

### Media

https://c5433dd5ed1ff15654384a6e4d12952d.7wzuvg.channel-assembly.mediatailor.us-east-1.amazonaws.com/v1/channel/canal3/playlist.m3u8

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['enhancement'],['icbaker'],,4
10991,r2.18.3,closed,2023-02-15 13:01:53,2023-04-17 01:05:38,2023-02-15 18:11:35,,[],['christosts'],,1
10990,Synchronize playback across multiple devices,closed,2023-02-15 09:52:31,2023-04-24 01:05:39,2023-02-22 13:08:39,"I have two Android programs(use exoplayer) playing the same mp4 file, and I am committed to keeping the playback time difference between the two programs within 16ms. But when I call the exact seekTo, I find that the difference between the two player is between 200-400ms, and I try other seekParameters, but the effect is not very good. Is there any better solution?",['question'],['tonihei'],,11
10989,Currently Dev Branch is missing an import in FrameProcessor,closed,2023-02-15 09:05:44,2023-04-17 01:05:39,2023-02-15 10:57:13,"<img width=""966"" alt=""Screen Shot 2023-02-15 at 10 57 53"" src=""https://user-images.githubusercontent.com/16818804/218982379-9578a966-0019-418f-a77f-0e17aa82f230.png"">
","['question', 'needs triage']",['andrewlewis'],,1
10988,NPE on handlePlayerStateChanged,closed,2023-02-15 08:27:23,2023-06-01 01:05:29,2023-03-21 01:06:08,"### ExoPlayer Version

2.17.1

### Devices that reproduce the issue

- Google TV
- Xiaomi  Mi TV
- Sharp TV
- TCL
- Changhong
- Etc

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Not tested

### Reproduction steps

Unknown

### Expected result

The media play successfully

### Actual result

```
> Fatal Exception: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.Class java.lang.Object.getClass()' on a null object reference
       at com.google.android.exoplayer2.util.Assertions.checkNotNull(Assertions.java:154)
       at com.google.android.exoplayer2.ext.ima.AdTagLoader.updateAdProgress(AdTagLoader.java:688)
       at com.google.android.exoplayer2.ext.ima.AdTagLoader.handlePlayerStateChanged(AdTagLoader.java:814)
       at com.google.android.exoplayer2.ext.ima.AdTagLoader.onPlaybackStateChanged(AdTagLoader.java:495)
       at com.google.android.exoplayer2.ExoPlayerImpl.lambda$updatePlaybackInfo$22(ExoPlayerImpl.java:1916)
       at com.google.android.exoplayer2.ExoPlayerImpl$$InternalSyntheticLambda$1$b132fcb325c34ac563536ede08c2aa5e54dc24d459a99c4a20673c9aa7c8f376$10.invoke$bridge(ExoPlayerImpl.java:21)
       at com.google.android.exoplayer2.util.ListenerSet$ListenerHolder.invoke(ListenerSet.java:281)
       at com.google.android.exoplayer2.util.ListenerSet.lambda$queueEvent$0(ListenerSet.java:190)
       at com.google.android.exoplayer2.util.ListenerSet$$InternalSyntheticLambda$2$84623593c2a26340561ccf78330ea2f1ed5a5ffef54877eb1edb03aa4d882c21$0.run(ListenerSet.java:23)
       at com.google.android.exoplayer2.util.ListenerSet.flushEvents(ListenerSet.java:211)
       at com.google.android.exoplayer2.ExoPlayerImpl.updatePlaybackInfo(ExoPlayerImpl.java:1947)
       at com.google.android.exoplayer2.ExoPlayerImpl.handlePlaybackInfo(ExoPlayerImpl.java:1774)
       at com.google.android.exoplayer2.ExoPlayerImpl.lambda$new$1(ExoPlayerImpl.java:306)
       at com.google.android.exoplayer2.ExoPlayerImpl.$r8$lambda$nOBJYkeEQ2uz3sBKLToLWmzrgZk(ExoPlayerImpl.java:216)
       at com.google.android.exoplayer2.ExoPlayerImpl$$InternalSyntheticLambda$2$87dd1a18cfb37560c5082e49219a5ca1cfe58b4494399f2c707a90a0afa53990$0.run(ExoPlayerImpl.java:4)
       at android.os.Handler.handleCallback(Handler.java:873)
       at android.os.Handler.dispatchMessage(Handler.java:99)
       at android.os.Looper.loop(Looper.java:193)
       at android.app.ActivityThread.main(ActivityThread.java:6680)
       at java.lang.reflect.Method.invoke(Method.java)
       at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493)
       at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:858)
```
```
> Fatal Exception: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.Class java.lang.Object.getClass()' on a null object reference
       at com.google.android.exoplayer2.util.Assertions.checkNotNull(Assertions.java:154)
       at com.google.android.exoplayer2.ext.ima.AdTagLoader.handlePlayerStateChanged(AdTagLoader.java:807)
       at com.google.android.exoplayer2.ext.ima.AdTagLoader.onPlaybackStateChanged(AdTagLoader.java:495)
       at com.google.android.exoplayer2.ExoPlayerImpl.lambda$updatePlaybackInfo$22(ExoPlayerImpl.java:1916)
       at com.google.android.exoplayer2.ExoPlayerImpl$$InternalSyntheticLambda$1$b132fcb325c34ac563536ede08c2aa5e54dc24d459a99c4a20673c9aa7c8f376$10.invoke$bridge(ExoPlayerImpl.java:21)
       at com.google.android.exoplayer2.util.ListenerSet$ListenerHolder.invoke(ListenerSet.java:281)
       at com.google.android.exoplayer2.util.ListenerSet.lambda$queueEvent$0(ListenerSet.java:190)
       at com.google.android.exoplayer2.util.ListenerSet$$InternalSyntheticLambda$2$84623593c2a26340561ccf78330ea2f1ed5a5ffef54877eb1edb03aa4d882c21$0.run(ListenerSet.java:23)
       at com.google.android.exoplayer2.util.ListenerSet.flushEvents(ListenerSet.java:211)
       at com.google.android.exoplayer2.ExoPlayerImpl.updatePlaybackInfo(ExoPlayerImpl.java:1947)
       at com.google.android.exoplayer2.ExoPlayerImpl.handlePlaybackInfo(ExoPlayerImpl.java:1774)
       at com.google.android.exoplayer2.ExoPlayerImpl.lambda$new$1(ExoPlayerImpl.java:306)
       at com.google.android.exoplayer2.ExoPlayerImpl.$r8$lambda$nOBJYkeEQ2uz3sBKLToLWmzrgZk(ExoPlayerImpl.java:216)
       at com.google.android.exoplayer2.ExoPlayerImpl$$InternalSyntheticLambda$2$87dd1a18cfb37560c5082e49219a5ca1cfe58b4494399f2c707a90a0afa53990$0.run(ExoPlayerImpl.java:4)
       at android.os.Handler.handleCallback(Handler.java:873)
       at android.os.Handler.dispatchMessage(Handler.java:99)
       at android.os.Looper.loop(Looper.java:193)
       at android.app.ActivityThread.main(ActivityThread.java:6718)
       at java.lang.reflect.Method.invoke(Method.java)
       at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493)
       at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:858)
```
### Media

Unknown

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['closed-by-bot'],['tonihei'],,6
10987,Memory leak when playing local video,closed,2023-02-15 07:09:44,2023-05-16 01:05:29,2023-03-16 01:06:07,"In the most simple demo

create player :

new Exoplayer.Builder().build

setMediaItem(MediaItem.from(videoPath))

styledvideoview set player 

prepare 
play

with local mp4 file play

the memeory use keep growthing by the time, and crash in the future
",['closed-by-bot'],['tonihei'],,3
10985,Is it possible to start a live stream (DASH or HLS) at a particular presentation date time?,closed,2023-02-14 23:01:20,2023-04-17 01:05:40,2023-02-15 13:33:40,"The problem I want to solve is to avoid a frame jump if user pauses and resumes a live stream. The live manifest for both DASH and HLS has a short live window which is 2 minutes. Let's say initially the user plays at live edge, we build a MediaItem as such:

```
val videoUrl1 = ""https://www.live.com?offsetFromLiveSeconds=0.mpd""
val mediaItem = MediaItem.Builder().setUri(videoUrl1).build()
```

Let's assume user pauses for 10 minutes, then clicks resume, then we need to build a new url:

```
val videoUrl2 = ""https://www.live.com?offsetFromLiveSeconds=600.mpd""
val mediaItem = MediaItem.Builder().setUri(videoUrl2).build()
```

The issue is that user will always see a frame jump after resuming because for ExoPlayer videoUrl1 and videoUrl2 are two unrelated manifest urls. What I think makes sense to do is remember the PDT of videoUrl1 when user pauses and when we starts playing videoUrl2 we set the initial PDT. But I cannot find exoPlayer api to do that. What I am looking for is basically something like this:

```
val videoUrl2 = ""https://www.live.com?offsetFromLiveSeconds=600""
val mediaItem = MediaItem.Builder().setUri(videoUrl2).setInitialPDT(pdt).build()
```

Is this supported by latest ExoPlayer r2.18.2?",['duplicate'],['tonihei'],,3
10984,"How can I change textColor, textFont, textSize of subtitles",closed,2023-02-14 06:44:36,2023-04-16 01:05:21,2023-02-14 07:40:39,"Unfortunately we can't answer all questions. Unclear questions or questions with
insufficient information may not get attention.

Before filing a question:
-------------------------

- Ask general Android development questions on Stack Overflow
- Search existing issues, including issues that are closed
  https://github.com/google/ExoPlayer/issues?q=is%3Aissue
- Consult our developer website (https://exoplayer.dev/) and Javadoc
  (https://exoplayer.dev/doc/reference/)

When filing a question:
-------------------------

Describe your question in detail.

In case your question refers to a problem you are seeing in your app:

- Output of running `$ adb bugreport` in the console

In case your question is related to a piece of media:

- URI to test content
- For protected content:
  - DRM scheme and license server URL
  - Authentication HTTP headers

Don't forget to check supported formats and devices
(https://exoplayer.dev/supported-formats.html).

If there's something you don't want to post publicly, please submit the issue,
then email the link/bug report to dev.exoplayer@gmail.com using a subject in the
format ""Issue #1234"", where #1234 is your issue number (we don't reply to
emails).
","['question', 'needs triage']",[],,0
10983,Getting live window time of HLS live stream,closed,2023-02-14 06:38:44,2023-05-05 01:05:25,2023-03-05 18:55:27,"I have a live HLS Stream.
Is there any API which can help me get the current live window time of Live Stream",['question'],['marcbaechinger'],,1
10982,can parse the frame rate of video when ts or trp file?,closed,2023-02-14 03:42:23,2023-06-04 01:05:08,2023-04-04 08:33:00,"when play a .mp4 file we can see the fps parameter in eventlog:

 D/EventLogger: downstreamFormat [eventTime=0.08, mediaPos=0.00, window=1, period=1, id=1, mimeType=video/avc, res=3840x2160, fps=29.970028]

D/EventLogger: videoInputFormat [eventTime=0.08, mediaPos=0.00, window=1, period=1, id=1, mimeType=video/avc, res=3840x2160, fps=29.970028]

But when play a .ts or trp file, there is no fps parameter.  whether can parse parameter fps of  .ts or .trp file?  Whether there are plans to support it in the future?

D/EventLogger: downstreamFormat [eventTime=2.24, mediaPos=0.00, window=5, period=5, id=1/256, mimeType=video/hevc, res=3840x2160]

D/EventLogger: videoInputFormat [eventTime=2.28, mediaPos=0.00, window=5, period=5, id=1/256, mimeType=video/hevc, res=3840x2160]
",['question'],['tonihei'],,1
10981,Are TTML subtitles supported in HLS?,closed,2023-02-13 21:58:06,2023-06-04 01:05:09,2023-04-04 08:32:52,"I have a stream that consists of fragmented MPEG-4 segments (separate audio and video segments), and also includes TTML/IMSC1 subtitle segments, also fMP4. I have a multivariant playlist and media playlists for each stream. Video and audio play as expected, and it appears the subtitle segments are being consumed by ExoPlayer, but I don't see anything on the screen. I do see subtitles with other input formats (including DASH with the same input streams), just not with HLS+TTML.

I see this message in Logcat:
`Text Track 0 Lang=en codec=stpp.ttml.im1t Label=eng`
which seems to indicate the track is properly selected. 

I'm using ExoPlayer 2.18.2.
",['question'],['tonihei'],,4
10980,WebVTT multi-line subtitles overlapping,open,2023-02-12 15:23:20,2023-03-06 12:42:11,,"### ExoPlayer Version

2.18.2

### Devices that reproduce the issue

* Pixel 4a running Android 13
* Fire HD 10 (9th generation) running Fire OS 7.3.2.7
* Emulator (Tablet, API 30)

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Play any video using a WebVTT subtitle track that contains two (or more) cues with overlapping time codes, the first of them also spanning multiple lines of text.

The multiple lines can result from explicit newline characters or text that is too long to fit in a single line (or a combination of both).

Can also be reproduced by using my sample WebVTT file in the demo app:

```
[
  {
    ""name"": ""Clear DASH"",
    ""samples"": [
      {
        ""name"": ""HD (MP4, H264)"",
        ""uri"": ""https://storage.googleapis.com/wvmedia/clear/h264/tears/tears.mpd"",
        ""subtitle_uri"": ""https://filebin.net/fuy39ich7mb93kwe/sample-multi-line-overlap.vtt"",
        ""subtitle_mime_type"": ""text/vtt""
      },
...
```

### Expected result

The subtitle cues should not visually overlap.

### Actual result

The subtitle cues overlap visually, with each simultaneously displayed cue only moving up one line, instead of however many line the previous cues already take up.

![image](https://user-images.githubusercontent.com/5994853/218319680-9715a209-ea25-4391-b61e-49e2541f38d6.png)

### Media

I do not have an easily shareable sample video, so I created a sample WebVTT file that should demonstrate the issue.
[sample-multi-line-overlap.zip](https://github.com/google/ExoPlayer/files/10716336/sample-multi-line-overlap.zip)

### Bug Report

- [ ] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug'],['icbaker'],,4
10979,Blank screen with audio in lastest version(when play video with audio),closed,2023-02-12 12:10:06,2023-04-16 01:05:22,2023-02-14 10:42:56,"I am new to exoplayer, and when i try to play a video from url(https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4)
Exoplayer play only audio with blank screen.
Here's my code:
main.xml
```xml
<LinearLayout
		android:layout_width=""match_parent""
		android:layout_height=""match_parent""
		android:orientation=""vertical""
		app:layout_behavior=""@string/appbar_scrolling_view_behavior"">
		<com.google.android.exoplayer2.ui.StyledPlayerView
			android:id=""@+id/playerView""
			android:layout_width=""match_parent""
			android:layout_height=""match_parent""
			android:padding=""8dp""
			android:orientation=""horizontal""
			app:show_shuffle_button=""true""
			app:show_subtitle_button=""true""
			app:show_timeout=""0"" />
	</LinearLayout>
```
and here's my java code:
```java
ExoPlayer player = new ExoPlayer.Builder(MainActivity.this).build();

playerView.setPlayer(player);

MediaItem mediaItem = MediaItem.fromUri(""https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"");

player.setMediaItem(mediaItem);

player.prepare();

player.setPlayWhenReady(true);

player.play();
```

And this is the result:
![20230212_140915](https://user-images.githubusercontent.com/100796146/218310199-4f265479-0d32-479c-885b-93fe0cf3d680.jpg)
",['question'],['marcbaechinger'],,2
10978,Flickering in notification using PlayerNotificationManager,closed,2023-02-10 23:28:53,2023-04-12 01:06:02,2023-02-11 00:21:41,"Hello ExoPlayer Team 
I am using  PlayerNotificationManager to show currently playing radio station. 

  I implement it as follows : 

```
class RadioNotificationManager (
    private val context : Context,
   sessionToken : MediaSessionCompat.Token,
   notificationListener: NotificationListener
    ) {

        private val notificationManager : PlayerNotificationManager

        init {

            val mediaController = MediaControllerCompat(context, sessionToken)

            notificationManager = PlayerNotificationManager.Builder(
                context,
                NOTIFICATION_ID,
               CHANNEL_ID
            ).setChannelNameResourceId(R.string.notification_channel_name)
                .setChannelDescriptionResourceId(R.string.notification_channel_description)
                .setMediaDescriptionAdapter(DescriptionAdapter(mediaController))
                .setNotificationListener(notificationListener)
                .build().apply {
                    setSmallIcon(R.drawable.ic_radio_default)
                    setMediaSessionToken(sessionToken)
                    setUseChronometer(false)

                }


        }

    fun showNotification(player : Player){

        notificationManager.setPlayer(player)
    }

    fun removeNotification () {
        notificationManager.setPlayer(null)
    }


    private inner class DescriptionAdapter (
        private val mediaController : MediaControllerCompat
            ) : MediaDescriptionAdapter {

        override fun getCurrentContentTitle(player: Player): CharSequence {

            return mediaController.metadata.description.title.toString()
        }

        override fun createCurrentContentIntent(player: Player): PendingIntent? {

            return mediaController.sessionActivity
        }

        override fun getCurrentContentText(player: Player): CharSequence? {
            return mediaController.metadata.description.subtitle.toString()
        }


        override fun getCurrentLargeIcon(
            player: Player,
            callback: PlayerNotificationManager.BitmapCallback
        ): Bitmap? {

          Glide.with(context).asBitmap()
                .load(mediaController.metadata.description.iconUri)
              .into(object : CustomTarget<Bitmap>(){
                  override fun onResourceReady(
                      resource: Bitmap,
                      transition: Transition<in Bitmap>?
                  ) {
                     callback.onBitmap(resource)
                  }
                  override fun onLoadCleared(placeholder: Drawable?) {
                  }
              })
            return null
        }
    }
}
```
Problem is it flicker almost every time I press play or pause. 

Since I don't use next - prev actions, only play - pause, maybe there is some way not to update notification if currently playing media item is the same. Or should I dig in direction of custom layout.
I can not find any solution. Your advice would be very much appreciated. ",['question'],['marcbaechinger'],,1
10977,NullPointerException when trying to read isTunnelingEnabled(),closed,2023-02-10 10:01:31,2023-04-12 01:06:03,2023-02-10 13:33:30,"### ExoPlayer Version

2.18.2

### Devices that reproduce the issue

- Samsung Galaxy S21 running Android 13
- NVIDIA Shield running Android 11

### Devices that do not reproduce the issue

_No response_

### Reproducible in the demo app?

Yes

### Reproduction steps

Add the following code to `onTracksChanged()` in `PlayerEventListener` in `PlayerActivity`
```
if (player != null) {
  Log.d(""ExoPlayerTunneling"", String.format(""isTunnelingEnabled=%b"", player.isTunnelingEnabled()));
}
```

1. Open demo app
2. Play `HLS > Apple 4x3 basic stream (TS)`. Not sure if all playbacks will crash, but this does.

### Expected result

Media plays and the console logs if tunneling is enabled or not

### Actual result

Crashes with the stack trace:
```
java.lang.NullPointerException: Attempt to read from field 'boolean com.google.android.exoplayer2.RendererConfiguration.tunneling' on a null object reference
    at com.google.android.exoplayer2.ExoPlayerImpl.isTunnelingEnabled(ExoPlayerImpl.java:1673)
    at com.google.android.exoplayer2.demo.PlayerActivity$PlayerEventListener.onTracksChanged(PlayerActivity.java:505)
    at com.google.android.exoplayer2.ExoPlayerImpl.lambda$updatePlaybackInfo$17(ExoPlayerImpl.java:1909)
    at com.google.android.exoplayer2.ExoPlayerImpl$$ExternalSyntheticLambda3.invoke(Unknown Source:4)
    at com.google.android.exoplayer2.util.ListenerSet$ListenerHolder.invoke(ListenerSet.java:282)
    at com.google.android.exoplayer2.util.ListenerSet.lambda$queueEvent$0(ListenerSet.java:190)
    at com.google.android.exoplayer2.util.ListenerSet$$ExternalSyntheticLambda1.run(Unknown Source:6)
    at com.google.android.exoplayer2.util.ListenerSet.flushEvents(ListenerSet.java:211)
    at com.google.android.exoplayer2.ExoPlayerImpl.updatePlaybackInfo(ExoPlayerImpl.java:1966)
    at com.google.android.exoplayer2.ExoPlayerImpl.handlePlaybackInfo(ExoPlayerImpl.java:1794)
    at com.google.android.exoplayer2.ExoPlayerImpl.lambda$new$1$com-google-android-exoplayer2-ExoPlayerImpl(ExoPlayerImpl.java:312)
    at com.google.android.exoplayer2.ExoPlayerImpl$$ExternalSyntheticLambda20.run(Unknown Source:4)
    at android.os.Handler.handleCallback(Handler.java:938)
    at android.os.Handler.dispatchMessage(Handler.java:99)
    at android.os.Looper.loop(Looper.java:223)
    at android.app.ActivityThread.main(ActivityThread.java:7668)
    at java.lang.reflect.Method.invoke(Native Method)
    at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)
    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)
```

### Media

`HLS > Apple 4x3 basic stream (TS)` from the demo app

### Bug Report

- [X] You will email the zip file produced by `adb bugreport` to dev.exoplayer@gmail.com after filing this issue.",['bug'],['icbaker'],,1
10976,Multperiod manifest with aac and dolby content has playback issues on firetv 4k (with exoplayer 2.18.1),open,2023-02-09 17:50:19,2023-02-27 18:00:27,,"Im trying to play a mixed content (aac + dolby) which are added in different periods of a manifest. But once the 2nd period starts (which has dolby content) the playback freezes and goes completely out of sync and then a total freeze at the end of this period. 
`adb logcat` at this time shows following spurious audio timestamp related logs:

```
09-21 17:34:57.312 19192 23498 W AudioTrack: Spurious audio timestamp (frame position mismatch): 28270119, 10923744015, 10923743917, 189528000, 9827328, 9827328
09-21 17:34:57.816 19192 23498 W AudioTrack: Spurious audio timestamp (frame position mismatch): 28294325, 10924248296, 10924248198, 189528000, 9827328, 9827328
09-21 17:34:58.211 19192 19231 V SessionStateManager: 2022-09-21 17:34:58,211 - Thread: [main] - player time 1663761496000ms program start time 1663759800000ms media session time 1696000ms
09-21 17:34:58.211 19192 19231 V SessionStateManager: 2022-09-21 17:34:58,211 - Thread: [main] - com.mobitv.client.connect.core.media.session.MobiMediaSession@34d0ee4 set media session playback state to PLAYING time 1696000ms
09-21 17:34:58.211 19192 19231 V SessionStateManager: 2022-09-21 17:34:58,211 - Thread: [main] - setting playback state PlaybackState {state=3, position=1696000, buffered position=0, speed=1.0, updated=10924643, actions=8963, error code=0, error message=null, custom actions=[], active item id=-1}
09-21 17:34:58.213   739   932 V Avrcp   : MediaController playback changed: PlaybackState {state=3, position=1696000, buffered position=0, speed=1.0, updated=10924643, actions=8963, custom actions=[], active item id=-1, error=null}
09-21 17:34:58.322 19192 23498 W AudioTrack: Spurious audio timestamp (frame position mismatch): 28318587, 10924753767, 10924753671, 189528000, 9827328, 9827328 
```
As of now I can confirm that this is something related to the dolby track because if the period contains only video track or video track + aac then the playback is smooth. 

Device details: FireTV stick 4K with Fire OS 6.2.9.3 (NS6293/4731) and exoplayer 2.18.1

Please find the test asset which can be used to reproduce this issue here:
https://drive.google.com/file/d/15AA_Q3ReKCNVv_zTGk32-T0_NDeqOfF1/view?usp=share_link

Can anyone please provide any hints or any possible configuration fix to avoid this playback issue ?
","['question', 'needs triage']",['tianyif'],,0
10975,How to set a stereo audio to play in mono?,closed,2023-02-09 11:11:13,2023-04-12 01:06:04,2023-02-10 08:39:48,"I hope to be able to mix the left and right channels into single -channel playback.
Due to the version update, some answers online are outdated and most APIs have changed. For the 2.x version, I have not been able to find an appropriate configuration method.

I found the following code, but they seem to have issues or don't exist:

```
TrackSelection.Factory audioTrackSelectionFactory =
        new AdaptiveTrackSelection.Factory(BANDWIDTH_METER);
TrackSelector trackSelector = new DefaultTrackSelector(audioTrackSelectionFactory);

RenderersFactory renderersFactory = new DefaultRenderersFactory(context);
AudioProcessor stereoToMono = new StereoToMonoConverter();
renderersFactory.setExtensionRendererMode(
        DefaultRenderersFactory.EXTENSION_RENDERER_MODE_PREFER,
        new AudioRendererEventListener() {
            @Override
            public void onAudioEnabled(DecoderCounters counters) {
                stereoToMono.setEnabled(true);
            }

            @Override
            public void onAudioDecoderInitialized(
                    String decoderName, long initializedTimestampMs, long initializationDurationMs) {
                stereoToMono.setEnabled(true);
            }

            @Override
            public void onAudioDisabled(DecoderCounters counters) {
                stereoToMono.setEnabled(false);
            }
        });

ExoPlayer player = ExoPlayerFactory.newSimpleInstance(renderersFactory, trackSelector);
```

Can I set the audio to play in mono?","['question', 'needs triage']",[],,2
